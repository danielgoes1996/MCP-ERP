"use strict";function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regenerator(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0))}if(o||r>1)return a;throw y=!0,n}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i["return"])&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break}catch(t){i=e,c=1,u=t}finally{f=1}}return{value:t,done:y}}}(r,o,i),!0),u}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,n,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,r,n,t)}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t["return"]&&(u=t["return"](),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(r){if(Array.isArray(r))return r}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}var _React=React,useState=_React.useState,useCallback=_React.useCallback,useRef=_React.useRef,useEffect=_React.useEffect,useMemo=_React.useMemo;var formatCurrency=function formatCurrency(amount){return"$".concat((amount||0).toLocaleString("es-MX",{minimumFractionDigits:2}))};var DashboardContent=function DashboardContent(_ref){var expensesData=_ref.expensesData,selectedMonth=_ref.selectedMonth,setSelectedMonth=_ref.setSelectedMonth,selectedCategoryFilter=_ref.selectedCategoryFilter,setSelectedCategoryFilter=_ref.setSelectedCategoryFilter,categorias=_ref.categorias,getCategoryInfo=_ref.getCategoryInfo;try{var dataset=Array.isArray(expensesData)?expensesData:[];var expensesInMonth=dataset.filter(function(expense){var _expense$fecha_gasto,_expense$fecha_creaci;var expenseMonth=((_expense$fecha_gasto=expense.fecha_gasto)===null||_expense$fecha_gasto===void 0?void 0:_expense$fecha_gasto.slice(0,7))||((_expense$fecha_creaci=expense.fecha_creacion)===null||_expense$fecha_creaci===void 0?void 0:_expense$fecha_creaci.slice(0,7));return expenseMonth===selectedMonth});var filteredExpenses=selectedCategoryFilter==="todos"?expensesInMonth:expensesInMonth.filter(function(expense){return expense.categoria===selectedCategoryFilter});var totalAmount=filteredExpenses.reduce(function(sum,expense){return sum+(expense.monto_total||0)},0);var categoryStats=categorias.map(function(cat){var categoryExpenses=expensesInMonth.filter(function(exp){return exp.categoria===cat.value});var total=categoryExpenses.reduce(function(sum,exp){return sum+(exp.monto_total||0)},0);return _objectSpread(_objectSpread({},cat),{},{count:categoryExpenses.length,total:total})}).filter(function(cat){return cat.count>0});var generateInsights=function generateInsights(){var insights=[];var currentDate=new Date(selectedMonth+"-01");var previousMonth=new Date(currentDate.getFullYear(),currentDate.getMonth()-1,1);var previousMonthStr=previousMonth.toISOString().slice(0,7);var previousMonthExpenses=dataset.filter(function(expense){var _expense$fecha_gasto2,_expense$fecha_creaci2;var expenseMonth=((_expense$fecha_gasto2=expense.fecha_gasto)===null||_expense$fecha_gasto2===void 0?void 0:_expense$fecha_gasto2.slice(0,7))||((_expense$fecha_creaci2=expense.fecha_creacion)===null||_expense$fecha_creaci2===void 0?void 0:_expense$fecha_creaci2.slice(0,7));return expenseMonth===previousMonthStr});var previousTotal=previousMonthExpenses.reduce(function(sum,exp){return sum+(exp.monto_total||0)},0);if(previousTotal>0){var change=(totalAmount-previousTotal)/previousTotal*100;var changeText=change>0?"aumentaron":"disminuyeron";var changeIcon=change>0?"\uD83D\uDCC8":"\uD83D\uDCC9";var changeColor=change>0?"text-red-600":"text-green-600";insights.push({icon:changeIcon,text:"Los gastos ".concat(changeText," ").concat(Math.abs(change).toFixed(1),"% vs mes anterior"),detail:"".concat(formatCurrency(previousTotal)," \u2192 ").concat(formatCurrency(totalAmount)),color:changeColor,type:"comparison"})}if(categoryStats.length>0){var topCategory=categoryStats.reduce(function(max,cat){return cat.total>max.total?cat:max});var percentage=(topCategory.total/totalAmount*100).toFixed(1);insights.push({icon:"\uD83C\uDFAF",text:"".concat(topCategory.label," representa el ").concat(percentage,"% del gasto total"),detail:"".concat(formatCurrency(topCategory.total)," en ").concat(topCategory.count," transacciones"),color:"text-blue-600",type:"category"})}var highExpenses=filteredExpenses.filter(function(exp){return exp.monto_total>1000});if(highExpenses.length>0){var totalHigh=highExpenses.reduce(function(sum,exp){return sum+exp.monto_total},0);insights.push({icon:"\u26A0\uFE0F",text:"".concat(highExpenses.length," gastos superiores a $1,000"),detail:"Total: ".concat(formatCurrency(totalHigh)),color:"text-orange-600",type:"alert"})}var today=new Date;var currentMonthStr=today.toISOString().slice(0,7);if(selectedMonth===currentMonthStr){var dayOfMonth=today.getDate();var daysInMonth=new Date(today.getFullYear(),today.getMonth()+1,0).getDate();var monthProgress=dayOfMonth/daysInMonth;if(monthProgress<0.9){var projectedTotal=totalAmount/monthProgress;insights.push({icon:"\uD83D\uDCCA",text:"Proyecci\xF3n del mes: ".concat(formatCurrency(projectedTotal)),detail:"Basado en ".concat(dayOfMonth," d\xEDas de ").concat(daysInMonth),color:"text-purple-600",type:"projection"})}}return insights};var aiInsights=generateInsights();return React.createElement("div",{className:"p-6 space-y-6"},React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Mes"),React.createElement("input",{type:"month",value:selectedMonth,onChange:function onChange(e){return setSelectedMonth(e.target.value)},className:"w-full p-2 border border-gray-300 rounded-lg"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Categor\xEDa"),React.createElement("select",{value:selectedCategoryFilter,onChange:function onChange(e){return setSelectedCategoryFilter(e.target.value)},className:"w-full p-2 border border-gray-300 rounded-lg"},React.createElement("option",{value:"todos"},"Todas las categor\xEDas"),categorias.map(function(cat){return React.createElement("option",{key:cat.value,value:cat.value},cat.label)})))),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},React.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4"},React.createElement("div",{className:"flex items-center"},React.createElement("i",{className:"fas fa-calculator text-blue-600 text-2xl mr-3"}),React.createElement("div",null,React.createElement("p",{className:"text-sm text-blue-600"},"Total del mes"),React.createElement("p",{className:"text-2xl font-bold text-blue-800"},"$",totalAmount.toLocaleString("es-MX",{minimumFractionDigits:2}))))),React.createElement("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4"},React.createElement("div",{className:"flex items-center"},React.createElement("i",{className:"fas fa-receipt text-green-600 text-2xl mr-3"}),React.createElement("div",null,React.createElement("p",{className:"text-sm text-green-600"},"Gastos registrados"),React.createElement("p",{className:"text-2xl font-bold text-green-800"},filteredExpenses.length)))),React.createElement("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4"},React.createElement("div",{className:"flex items-center"},React.createElement("i",{className:"fas fa-tags text-orange-600 text-2xl mr-3"}),React.createElement("div",null,React.createElement("p",{className:"text-sm text-orange-600"},"Categor\xEDas activas"),React.createElement("p",{className:"text-2xl font-bold text-orange-800"},categoryStats.length))))),aiInsights.length>0&&React.createElement("div",null,React.createElement("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},React.createElement("i",{className:"fas fa-brain text-pink-600 mr-2"}),"Insights IA",React.createElement("span",{className:"ml-2 px-2 py-1 bg-pink-100 text-pink-700 text-xs rounded-full"},"An\xE1lisis Inteligente")),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"},aiInsights.map(function(insight,index){return React.createElement("div",{key:index,className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow"},React.createElement("div",{className:"flex items-start space-x-3"},React.createElement("span",{className:"text-2xl flex-shrink-0"},insight.icon),React.createElement("div",{className:"flex-1"},React.createElement("p",{className:"font-medium ".concat(insight.color)},insight.text),React.createElement("p",{className:"text-sm text-gray-600 mt-1"},insight.detail),React.createElement("span",{className:"inline-block mt-2 px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded"},insight.type==="comparison"&&"Comparaci\xF3n",insight.type==="category"&&"An\xE1lisis de categor\xEDas",insight.type==="alert"&&"Alerta",insight.type==="projection"&&"Proyecci\xF3n"))))}))),React.createElement("div",null,React.createElement("h3",{className:"text-lg font-semibold text-gray-900 mb-4"},"Desglose por Categor\xEDas"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},categoryStats.map(function(cat){return React.createElement("div",{key:cat.value,className:"p-4 rounded-lg border ".concat(cat.color.replace("text-","border-").replace("-800","-200"))},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center"},React.createElement("span",{className:"text-2xl mr-3"},cat.label.split(" ")[0]),React.createElement("div",null,React.createElement("h4",{className:"font-medium text-gray-900"},cat.label.substring(2)),React.createElement("p",{className:"text-sm text-gray-600"},cat.count," gastos"))),React.createElement("div",{className:"text-right"},React.createElement("p",{className:"text-lg font-bold text-gray-900"},"$",cat.total.toLocaleString("es-MX",{minimumFractionDigits:2})),React.createElement("p",{className:"text-sm text-gray-500"},totalAmount>0?Math.round(cat.total/totalAmount*100):0,"%"))))}))),React.createElement("div",null,React.createElement("h3",{className:"text-lg font-semibold text-gray-900 mb-4"},"Detalle de Gastos"),React.createElement("div",{className:"max-h-96 overflow-y-auto"},React.createElement("div",{className:"space-y-3"},filteredExpenses.map(function(expense){var _expense$proveedor;var categoryInfo=getCategoryInfo(expense.categoria);return React.createElement("div",{key:expense.id,className:"bg-white border border-gray-200 rounded-lg p-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(categoryInfo.color)},categoryInfo.label),React.createElement("div",null,React.createElement("h4",{className:"font-medium text-gray-900"},expense.descripcion),React.createElement("p",{className:"text-sm text-gray-600"},expense["proveedor.nombre"]||(typeof expense.proveedor==="string"?expense.proveedor:(_expense$proveedor=expense.proveedor)===null||_expense$proveedor===void 0?void 0:_expense$proveedor.nombre)||"Sin proveedor"," \u2022 ",expense.fecha_gasto))),React.createElement("div",{className:"text-right"},React.createElement("p",{className:"text-lg font-bold text-gray-900"},"$",(expense.monto_total||0).toLocaleString("es-MX",{minimumFractionDigits:2})),React.createElement("p",{className:"text-xs ".concat(expense.estado_factura==="pendiente"?"text-orange-600":expense.estado_factura==="no_requiere"?"text-gray-500":"text-green-600")},expense.estado_factura==="pendiente"?"\u23F3 Pendiente factura":expense.estado_factura==="no_requiere"?"\u2796 Sin factura":"\u2705 Facturado"))))}),filteredExpenses.length===0&&React.createElement("div",{className:"text-center py-8 text-gray-500"},React.createElement("i",{className:"fas fa-inbox text-4xl mb-4"}),React.createElement("p",null,"No hay gastos registrados para este per\xEDodo"))))))}catch(error){console.error("DashboardContent error:",error);var message=(error===null||error===void 0?void 0:error.message)||"Error desconocido";return React.createElement("div",{className:"p-4 text-red-600 bg-red-50 border border-red-200 rounded-lg"},"Error al mostrar dashboard de gastos: ",message)}};var PendingInvoicesContent=function PendingInvoicesContent(_ref2){var expensesData=_ref2.expensesData,onRegisterInvoice=_ref2.onRegisterInvoice,onMarkInvoiced=_ref2.onMarkInvoiced,onCloseNoInvoice=_ref2.onCloseNoInvoice,onOpenNonReconciliation=_ref2.onOpenNonReconciliation;try{var dataset=Array.isArray(expensesData)?expensesData:[];var pendingInvoices=dataset.filter(function(expense){return expense.estado_factura==="pendiente"});var _useState=useState(null),_useState2=_slicedToArray(_useState,2),invoiceFormExpense=_useState2[0],setInvoiceFormExpense=_useState2[1];var _useState3=useState({invoiceId:"",invoiceUrl:""}),_useState4=_slicedToArray(_useState3,2),invoiceFormData=_useState4[0],setInvoiceFormData=_useState4[1];var _useState5=useState(""),_useState6=_slicedToArray(_useState5,2),invoiceFormError=_useState6[0],setInvoiceFormError=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),confirmNoInvoiceExpense=_useState8[0],setConfirmNoInvoiceExpense=_useState8[1];var _useState9=useState(null),_useState0=_slicedToArray(_useState9,2),confirmMarkInvoicedExpense=_useState0[0],setConfirmMarkInvoicedExpense=_useState0[1];var _useState1=useState(false),_useState10=_slicedToArray(_useState1,2),isSavingInvoice=_useState10[0],setIsSavingInvoice=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isConfirmingMark=_useState12[0],setIsConfirmingMark=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isConfirmingNoInvoice=_useState14[0],setIsConfirmingNoInvoice=_useState14[1];var analyzeUrgency=function analyzeUrgency(expense){var daysOld=expense.fecha_gasto?Math.floor((new Date-new Date(expense.fecha_gasto))/(1000*60*60*24)):0;var amount=expense.monto_total||0;var urgencyLevel="low";var urgencyColor="text-green-600";var urgencyIcon="\uD83D\uDFE2";var urgencyText="Baja prioridad";if(daysOld>25||amount>5000){urgencyLevel="critical";urgencyColor="text-red-600";urgencyIcon="\uD83D\uDD34";urgencyText="Cr\xEDtico"}else if(daysOld>15||amount>2000){urgencyLevel="high";urgencyColor="text-orange-600";urgencyIcon="\uD83D\uDFE1";urgencyText="Alta prioridad"}else if(daysOld>7||amount>1000){urgencyLevel="medium";urgencyColor="text-yellow-600";urgencyIcon="\uD83D\uDFE0";urgencyText="Prioridad media"}return{level:urgencyLevel,color:urgencyColor,icon:urgencyIcon,text:urgencyText,daysOld:daysOld,reasons:[daysOld>25&&"M\xE1s de 25 d\xEDas sin facturar",daysOld>15&&daysOld<=25&&"M\xE1s de 15 d\xEDas sin facturar",daysOld>7&&daysOld<=15&&"M\xE1s de 7 d\xEDas sin facturar",amount>5000&&"Monto superior a $5,000",amount>2000&&amount<=5000&&"Monto superior a $2,000",amount>1000&&amount<=2000&&"Monto superior a $1,000"].filter(Boolean)}};var sortedPendingInvoices=_toConsumableArray(pendingInvoices).sort(function(a,b){var urgencyA=analyzeUrgency(a);var urgencyB=analyzeUrgency(b);var urgencyOrder={critical:4,high:3,medium:2,low:1};return urgencyOrder[urgencyB.level]-urgencyOrder[urgencyA.level]});var urgencyStats={critical:pendingInvoices.filter(function(exp){return analyzeUrgency(exp).level==="critical"}).length,high:pendingInvoices.filter(function(exp){return analyzeUrgency(exp).level==="high"}).length,medium:pendingInvoices.filter(function(exp){return analyzeUrgency(exp).level==="medium"}).length,low:pendingInvoices.filter(function(exp){return analyzeUrgency(exp).level==="low"}).length};var registerInvoice=function registerInvoice(expense){var defaultUrl=expense.factura_url||"https://erp.tuempresa.com/facturas/".concat(expense.factura_id||"");setInvoiceFormExpense(expense);setInvoiceFormData({invoiceId:expense.factura_id||"",invoiceUrl:defaultUrl});setInvoiceFormError("")};var markAsInvoiced=function markAsInvoiced(expenseId){var expense=dataset.find(function(exp){return exp.id===expenseId});if(!expense)return;if(!expense.factura_id){registerInvoice(expense);return}setConfirmMarkInvoicedExpense(expense)};var markAsNoInvoice=function markAsNoInvoice(expense){setConfirmNoInvoiceExpense(expense)};var handleInvoiceFormSubmit=function(){var _ref3=_asyncToGenerator(_regenerator().m(function _callee(){var trimmedId,trimmedUrl,_t;return _regenerator().w(function(_context){while(1)switch(_context.p=_context.n){case 0:if(invoiceFormExpense){_context.n=1;break}return _context.a(2);case 1:trimmedId=invoiceFormData.invoiceId.trim();trimmedUrl=(invoiceFormData.invoiceUrl||"").trim()||"https://erp.tuempresa.com/facturas/".concat(trimmedId);if(trimmedId){_context.n=2;break}setInvoiceFormError("Ingresa el folio de la factura.");return _context.a(2);case 2:if(onRegisterInvoice){_context.n=3;break}return _context.a(2);case 3:_context.p=3;setIsSavingInvoice(true);_context.n=4;return onRegisterInvoice(invoiceFormExpense.id,{uuid:trimmedId,folio:trimmedId,url:trimmedUrl,actor:"ui"});case 4:setInvoiceFormExpense(null);setInvoiceFormData({invoiceId:"",invoiceUrl:""});setInvoiceFormError("");_context.n=6;break;case 5:_context.p=5;_t=_context.v;console.error("Error registrando factura:",_t);setInvoiceFormError((_t===null||_t===void 0?void 0:_t.message)||"No se pudo registrar la factura");case 6:_context.p=6;setIsSavingInvoice(false);return _context.f(6);case 7:return _context.a(2)}},_callee,null,[[3,5,6,7]])}));return function handleInvoiceFormSubmit(){return _ref3.apply(this,arguments)}}();var handleConfirmMarkInvoiced=function(){var _ref4=_asyncToGenerator(_regenerator().m(function _callee2(){var _t2;return _regenerator().w(function(_context2){while(1)switch(_context2.p=_context2.n){case 0:if(confirmMarkInvoicedExpense){_context2.n=1;break}return _context2.a(2);case 1:if(onMarkInvoiced){_context2.n=2;break}return _context2.a(2);case 2:_context2.p=2;setIsConfirmingMark(true);_context2.n=3;return onMarkInvoiced(confirmMarkInvoicedExpense.id);case 3:setConfirmMarkInvoicedExpense(null);_context2.n=5;break;case 4:_context2.p=4;_t2=_context2.v;console.error("Error marcando como facturado:",_t2);case 5:_context2.p=5;setIsConfirmingMark(false);return _context2.f(5);case 6:return _context2.a(2)}},_callee2,null,[[2,4,5,6]])}));return function handleConfirmMarkInvoiced(){return _ref4.apply(this,arguments)}}();var handleConfirmNoInvoice=function(){var _ref5=_asyncToGenerator(_regenerator().m(function _callee3(){var _t3;return _regenerator().w(function(_context3){while(1)switch(_context3.p=_context3.n){case 0:if(confirmNoInvoiceExpense){_context3.n=1;break}return _context3.a(2);case 1:if(onCloseNoInvoice){_context3.n=2;break}return _context3.a(2);case 2:_context3.p=2;setIsConfirmingNoInvoice(true);_context3.n=3;return onCloseNoInvoice(confirmNoInvoiceExpense.id);case 3:setConfirmNoInvoiceExpense(null);_context3.n=5;break;case 4:_context3.p=4;_t3=_context3.v;console.error("Error cerrando sin factura:",_t3);case 5:_context3.p=5;setIsConfirmingNoInvoice(false);return _context3.f(5);case 6:return _context3.a(2)}},_callee3,null,[[2,4,5,6]])}));return function handleConfirmNoInvoice(){return _ref5.apply(this,arguments)}}();var openNonReconciliationModal=function openNonReconciliationModal(expense){if(typeof onOpenNonReconciliation==="function"){onOpenNonReconciliation(expense)}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"p-6 space-y-4"},React.createElement("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4"},React.createElement("h3",{className:"font-medium text-orange-800 mb-2"},"\uD83D\uDCCB ",pendingInvoices.length," gastos pendientes de facturaci\xF3n"),React.createElement("p",{className:"text-sm text-orange-700"},"Estos gastos requieren factura CFDI pero a\xFAn no han sido procesados")),pendingInvoices.length>0&&React.createElement("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-4"},React.createElement("h4",{className:"font-medium text-gray-900 mb-3 flex items-center"},React.createElement("i",{className:"fas fa-brain text-pink-600 mr-2"}),"An\xE1lisis de Urgencia IA"),React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3"},React.createElement("div",{className:"text-center p-3 bg-red-50 rounded-lg"},React.createElement("div",{className:"text-2xl mb-1"},"\uD83D\uDD34"),React.createElement("div",{className:"text-lg font-bold text-red-600"},urgencyStats.critical),React.createElement("div",{className:"text-xs text-red-700"},"Cr\xEDtico")),React.createElement("div",{className:"text-center p-3 bg-orange-50 rounded-lg"},React.createElement("div",{className:"text-2xl mb-1"},"\uD83D\uDFE1"),React.createElement("div",{className:"text-lg font-bold text-orange-600"},urgencyStats.high),React.createElement("div",{className:"text-xs text-orange-700"},"Alta")),React.createElement("div",{className:"text-center p-3 bg-yellow-50 rounded-lg"},React.createElement("div",{className:"text-2xl mb-1"},"\uD83D\uDFE0"),React.createElement("div",{className:"text-lg font-bold text-yellow-600"},urgencyStats.medium),React.createElement("div",{className:"text-xs text-yellow-700"},"Media")),React.createElement("div",{className:"text-center p-3 bg-green-50 rounded-lg"},React.createElement("div",{className:"text-2xl mb-1"},"\uD83D\uDFE2"),React.createElement("div",{className:"text-lg font-bold text-green-600"},urgencyStats.low),React.createElement("div",{className:"text-xs text-green-700"},"Baja")))),React.createElement("div",{className:"max-h-96 overflow-y-auto space-y-3"},sortedPendingInvoices.map(function(expense){var _expense$proveedor2;var urgencyAnalysis=analyzeUrgency(expense);return React.createElement("div",{key:expense.id,className:"border border-gray-200 rounded-lg p-4 bg-white"},React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("div",{className:"flex-1"},React.createElement("h4",{className:"font-medium text-gray-900"},expense.descripcion),React.createElement("div",{className:"flex items-center gap-2 mt-1"},React.createElement("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(urgencyAnalysis.color," bg-opacity-10")},urgencyAnalysis.icon," ",urgencyAnalysis.text),React.createElement("span",{className:"text-xs text-gray-500"},urgencyAnalysis.daysOld," d\xEDas")),urgencyAnalysis.reasons.length>0&&React.createElement("div",{className:"mt-1 text-xs text-gray-500"},urgencyAnalysis.reasons.join(", "))),React.createElement("span",{className:"text-lg font-bold text-gray-900"},formatCurrency(expense.monto_total))),React.createElement("div",{className:"text-sm text-gray-600 mb-3"},React.createElement("p",null,"Proveedor: ",expense["proveedor.nombre"]||(typeof expense.proveedor==="string"?expense.proveedor:(_expense$proveedor2=expense.proveedor)===null||_expense$proveedor2===void 0?void 0:_expense$proveedor2.nombre)||"Sin especificar"),React.createElement("p",null,"Fecha: ",expense.fecha_gasto),expense.rfc&&React.createElement("p",null,"RFC: ",expense.rfc),React.createElement("p",{className:"text-xs text-gray-500"},"Flujo: ",expense.workflow_status==="facturado"?"Facturado":expense.workflow_status==="pendiente_factura"?"Pendiente de factura":"Cerrado sin factura"),expense.factura_id?React.createElement("p",{className:"mt-2 text-xs text-blue-700 flex items-center gap-2"},React.createElement("i",{className:"fas fa-file-invoice"}),"Factura registrada: ",expense.factura_id):React.createElement("p",{className:"mt-2 text-xs text-red-600 flex items-center gap-2"},React.createElement("i",{className:"fas fa-exclamation-triangle"}),"Falta adjuntar la factura CFDI"),expense.tax_info&&React.createElement("div",{className:"mt-2 text-xs text-blue-600"},"IVA acreditable: $",Number(expense.tax_info.iva_amount||0).toLocaleString("es-MX",{minimumFractionDigits:2}))),React.createElement("div",{className:"flex gap-2"},React.createElement("button",{onClick:function onClick(){return registerInvoice(expense)},className:"px-3 py-1 bg-blue-50 text-blue-700 text-sm rounded-lg border border-blue-200 hover:bg-blue-100 transition-colors"},"\uD83D\uDCC4 Registrar/editar factura"),React.createElement("button",{onClick:function onClick(){return markAsInvoiced(expense.id)},className:"px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors"},"\u2705 Conciliar con factura"),React.createElement("button",{className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors"},"\uD83D\uDCC4 Ver detalles"),React.createElement("button",{onClick:function onClick(){return markAsNoInvoice(expense)},className:"px-3 py-1 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},"\uD83D\uDEAB No se pudo facturar"),React.createElement("button",{onClick:function onClick(){return openNonReconciliationModal(expense)},className:"px-3 py-1 text-sm text-orange-600 border border-orange-300 rounded-lg hover:bg-orange-50 transition-colors"},"\u26A0\uFE0F No se puede conciliar")))}),pendingInvoices.length===0&&React.createElement("div",{className:"text-center py-8 text-gray-500"},React.createElement("i",{className:"fas fa-check-circle text-4xl mb-4"}),React.createElement("p",null,"No hay facturas pendientes"),React.createElement("p",{className:"text-sm"},"Todos los gastos que requieren factura est\xE1n al d\xEDa")))),invoiceFormExpense&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full"},React.createElement("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between"},React.createElement("div",null,React.createElement("h3",{className:"text-lg font-semibold text-gray-900"},"Registrar factura CFDI"),React.createElement("p",{className:"text-sm text-gray-600"},"Completa los datos para ",invoiceFormExpense.descripcion)),React.createElement("button",{onClick:function onClick(){return setInvoiceFormExpense(null)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar formulario de factura"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"p-6 space-y-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Folio CFDI"),React.createElement("input",{type:"text",value:invoiceFormData.invoiceId,onChange:function onChange(e){setInvoiceFormData(function(prev){return _objectSpread(_objectSpread({},prev),{},{invoiceId:e.target.value})});setInvoiceFormError("")},className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"UUID o folio de la factura"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"URL de consulta"),React.createElement("input",{type:"url",value:invoiceFormData.invoiceUrl,onChange:function onChange(e){return setInvoiceFormData(function(prev){return _objectSpread(_objectSpread({},prev),{},{invoiceUrl:e.target.value})})},className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"https://"})),!invoiceFormExpense.tax_info&&React.createElement("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-lg px-3 py-2 text-sm"},"No se detectaron impuestos en el CFDI. Puedes completar esta informaci\xF3n m\xE1s tarde."),invoiceFormError&&React.createElement("div",{className:"text-sm text-red-600"},invoiceFormError)),React.createElement("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3"},React.createElement("button",{onClick:function onClick(){return setInvoiceFormExpense(null)},className:"px-4 py-2 text-sm text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg"},"Cancelar"),React.createElement("button",{onClick:handleInvoiceFormSubmit,className:"px-4 py-2 text-sm text-white bg-orange-600 hover:bg-orange-700 rounded-lg disabled:opacity-50",disabled:isSavingInvoice},isSavingInvoice?"Guardando...":"Guardar factura")))),confirmMarkInvoicedExpense&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full"},React.createElement("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between"},React.createElement("h3",{className:"text-lg font-semibold text-gray-900"},"Confirmar conciliaci\xF3n"),React.createElement("button",{onClick:function onClick(){return setConfirmMarkInvoicedExpense(null)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar confirmaci\xF3n de conciliaci\xF3n"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"p-6 space-y-3 text-sm text-gray-700"},React.createElement("p",null,"\xBFMarcar el gasto ",React.createElement("strong",null,confirmMarkInvoicedExpense.descripcion)," como facturado?"),React.createElement("p",{className:"text-gray-500"},"Se mover\xE1 al estatus \u201Cpendiente de conciliaci\xF3n bancaria\u201D.")),React.createElement("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3"},React.createElement("button",{onClick:function onClick(){return setConfirmMarkInvoicedExpense(null)},className:"px-4 py-2 text-sm text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg"},"Cancelar"),React.createElement("button",{onClick:handleConfirmMarkInvoiced,className:"px-4 py-2 text-sm text-white bg-green-600 hover:bg-green-700 rounded-lg disabled:opacity-50",disabled:isConfirmingMark},isConfirmingMark?"Marcando...":"Marcar como facturado")))),confirmNoInvoiceExpense&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full"},React.createElement("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between"},React.createElement("h3",{className:"text-lg font-semibold text-gray-900"},"Cerrar sin factura"),React.createElement("button",{onClick:function onClick(){return setConfirmNoInvoiceExpense(null)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar confirmaci\xF3n sin factura"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"p-6 space-y-3 text-sm text-gray-700"},React.createElement("p",null,"\xBFConfirmas que el gasto ",React.createElement("strong",null,confirmNoInvoiceExpense.descripcion)," no tendr\xE1 factura CFDI?"),React.createElement("p",{className:"text-gray-500"},"El flujo se cerrar\xE1 como \u201Csin factura\u201D y se quitar\xE1n datos fiscales.")),React.createElement("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3"},React.createElement("button",{onClick:function onClick(){return setConfirmNoInvoiceExpense(null)},className:"px-4 py-2 text-sm text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg"},"Cancelar"),React.createElement("button",{onClick:handleConfirmNoInvoice,className:"px-4 py-2 text-sm text-white bg-red-600 hover:bg-red-700 rounded-lg disabled:opacity-50",disabled:isConfirmingNoInvoice},isConfirmingNoInvoice?"Cerrando...":"Cerrar sin factura")))))}catch(error){console.error("PendingInvoicesContent error:",error);var message=(error===null||error===void 0?void 0:error.message)||"Error desconocido";return React.createElement("div",{className:"p-4 text-red-600 bg-red-50 border border-red-200 rounded-lg"},"Error al mostrar facturas pendientes: ",message)}};var SAMPLE_BANK_MOVEMENTS=[{movement_id:"MOV-001",id:"MOV-001",movement_date:"2024-09-01",fecha:"2024-09-01",bank:"BBVA",banco:"BBVA",description:"Cargo Tarjeta Empresarial - Pemex",descripcion:"Cargo Tarjeta Empresarial - Pemex",amount:845.32,monto:845.32,currency:"MXN",tags:["combustible","tarjeta_empresa"]},{movement_id:"MOV-002",id:"MOV-002",movement_date:"2024-09-02",fecha:"2024-09-02",bank:"Santander",banco:"Santander",description:"Cargo Tarjeta Empresarial - Restaurante",descripcion:"Cargo Tarjeta Empresarial - Restaurante",amount:562.1,monto:562.1,currency:"MXN",tags:["alimentos","tarjeta_empresa"]},{movement_id:"MOV-003",id:"MOV-003",movement_date:"2024-09-03",fecha:"2024-09-03",bank:"Banorte",banco:"Banorte",description:"Transferencia a proveedor ACME",descripcion:"Transferencia a proveedor ACME",amount:2100,monto:2100,currency:"MXN",tags:["proveedor","transferencia"]},{movement_id:"MOV-004",id:"MOV-004",movement_date:"2024-09-05",fecha:"2024-09-05",bank:"HSBC",banco:"HSBC",description:"Cargo Uber Business",descripcion:"Cargo Uber Business",amount:152.75,monto:152.75,currency:"MXN",tags:["transporte","tarjeta_empresa"]}];var InvoiceUploadContent=function InvoiceUploadContent(_ref6){var expensesData=_ref6.expensesData,setExpensesData=_ref6.setExpensesData;var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),selectedFiles=_useState16[0],setSelectedFiles=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isUploading=_useState18[0],setIsUploading=_useState18[1];var handleFileSelection=function handleFileSelection(files){setSelectedFiles(Array.from(files))};var processInvoices=function(){var _ref7=_asyncToGenerator(_regenerator().m(function _callee4(){return _regenerator().w(function(_context4){while(1)switch(_context4.n){case 0:setIsUploading(true);_context4.n=1;return new Promise(function(resolve){return setTimeout(resolve,2000)});case 1:alert("".concat(selectedFiles.length," facturas procesadas exitosamente"));setSelectedFiles([]);setIsUploading(false);case 2:return _context4.a(2)}},_callee4)}));return function processInvoices(){return _ref7.apply(this,arguments)}}();return React.createElement("div",{className:"p-6 space-y-4"},React.createElement("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4"},React.createElement("h3",{className:"font-medium text-green-800 mb-2"},"\uD83D\uDCE4 Carga masiva de facturas"),React.createElement("p",{className:"text-sm text-green-700"},"Sube m\xFAltiples facturas XML/PDF para procesamiento autom\xE1tico")),React.createElement("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center"},React.createElement("input",{type:"file",id:"invoice-files",multiple:true,accept:".xml,.pdf",className:"hidden",onChange:function onChange(e){return handleFileSelection(e.target.files)}}),React.createElement("label",{htmlFor:"invoice-files",className:"cursor-pointer"},React.createElement("i",{className:"fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"}),React.createElement("p",{className:"text-lg font-medium text-gray-700"},"Arrastra facturas aqu\xED o haz clic para seleccionar"),React.createElement("p",{className:"text-sm text-gray-500 mt-2"},"Soporta archivos XML y PDF"))),selectedFiles.length>0&&React.createElement("div",{className:"space-y-2"},React.createElement("h4",{className:"font-medium text-gray-900"},"Archivos seleccionados:"),selectedFiles.map(function(file,index){return React.createElement("div",{key:index,className:"flex items-center justify-between bg-gray-50 p-2 rounded"},React.createElement("span",{className:"text-sm"},file.name),React.createElement("span",{className:"text-xs text-gray-500"},(file.size/1024/1024).toFixed(2)," MB"))}),React.createElement("button",{onClick:processInvoices,disabled:isUploading,className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50"},isUploading?"Procesando...":"Procesar ".concat(selectedFiles.length," facturas"))))};var ReconciliationContent=function ReconciliationContent(_ref8){var expensesData=_ref8.expensesData;var pendingExpenses=expensesData.filter(function(expense){return expense.estado_factura==="pendiente"});var invoicedExpenses=expensesData.filter(function(expense){return expense.estado_factura==="facturado"});var totalConciliated=invoicedExpenses.length;var totalTracked=pendingExpenses.length+totalConciliated;var conciliatedPercentage=(totalConciliated/(totalTracked||1)*100).toFixed(1);return React.createElement("div",{className:"p-6 space-y-4"},React.createElement("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4"},React.createElement("h3",{className:"font-medium text-purple-800 mb-2"},"\u2696\uFE0F Conciliador de Gastos vs Facturas"),React.createElement("p",{className:"text-sm text-purple-700"},"Revisa el avance del ciclo gasto \u2192 factura y verifica qu\xE9 gastos ya est\xE1n listos para pasar a conciliaci\xF3n bancaria.")),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",{className:"bg-white border border-gray-200 rounded-lg p-4"},React.createElement("h4",{className:"font-medium text-gray-900 mb-3 flex items-center"},React.createElement("i",{className:"fas fa-exclamation-circle text-orange-500 mr-2"}),"Gastos sin conciliar (",pendingExpenses.length,")"),React.createElement("div",{className:"space-y-2 max-h-64 overflow-y-auto"},pendingExpenses.map(function(expense){return React.createElement("div",{key:expense.id,className:"p-3 bg-orange-50 border border-orange-200 rounded"},React.createElement("p",{className:"font-medium text-sm"},expense.descripcion),React.createElement("p",{className:"text-xs text-gray-600"},formatCurrency(expense.monto_total)," \u2022 ",expense.fecha_gasto),!expense.factura_id?React.createElement("p",{className:"text-xs text-red-600 mt-1 flex items-center gap-1"},React.createElement("i",{className:"fas fa-times-circle"}),"Este gasto a\xFAn no tiene factura registrada."):React.createElement("p",{className:"text-xs text-orange-700 mt-1 flex items-center gap-1"},React.createElement("i",{className:"fas fa-clock"}),"Factura ",expense.factura_id," registrada, pendiente de conciliar."))}),pendingExpenses.length===0&&React.createElement("div",{className:"text-center text-sm text-gray-500 py-6"},React.createElement("i",{className:"fas fa-check text-green-500 text-2xl mb-2"}),React.createElement("p",null,"Todos los gastos con factura ya est\xE1n conciliados.")))),React.createElement("div",{className:"bg-white border border-gray-200 rounded-lg p-4"},React.createElement("h4",{className:"font-medium text-gray-900 mb-3 flex items-center"},React.createElement("i",{className:"fas fa-check-circle text-green-500 mr-2"}),"Gastos conciliados (",invoicedExpenses.length,")"),React.createElement("div",{className:"space-y-2 max-h-64 overflow-y-auto"},invoicedExpenses.map(function(expense){var movimientos=expense.movimientos_bancarios||(expense.movimiento_bancario?[expense.movimiento_bancario]:[]);return React.createElement("div",{key:expense.id,className:"p-3 bg-green-50 border border-green-200 rounded space-y-2"},React.createElement("p",{className:"font-medium text-sm"},expense.descripcion),React.createElement("p",{className:"text-xs text-gray-600"},formatCurrency(expense.monto_total)," \u2022 ",expense.fecha_gasto),React.createElement("div",{className:"mt-2 text-xs text-green-700 flex flex-wrap items-center gap-2"},React.createElement("i",{className:"fas fa-file-invoice"}),React.createElement("span",null,"Factura ",expense.factura_id||"sin folio"),React.createElement("a",{href:expense.factura_url||"#",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline"},"Abrir factura")),movimientos.length>0?React.createElement("div",{className:"text-xs text-indigo-700 space-y-1"},movimientos.map(function(mov,idx){return React.createElement("div",{key:idx,className:"flex items-center justify-between"},React.createElement("span",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-university"}),mov.bank||mov.banco," \u2022 ",mov.description||mov.descripcion),React.createElement("span",null,formatCurrency(mov.amount||mov.monto||0)))}),expense.tax_info&&React.createElement("div",{className:"flex items-center gap-2 text-green-600"},React.createElement("i",{className:"fas fa-file-invoice"}),React.createElement("span",null,"IVA acreditable: $",Number(expense.tax_info.iva_amount||0).toLocaleString("es-MX",{minimumFractionDigits:2})))):React.createElement("div",{className:"mt-2 text-xs text-gray-600 flex items-center gap-2"},React.createElement("i",{className:"fas fa-arrow-right"}),React.createElement("span",null,"Listo para conciliaci\xF3n bancaria.")),React.createElement("p",{className:"text-xs text-gray-500"},"Flujo: ",expense.workflow_status==="facturado"?"Facturado":expense.workflow_status==="pendiente_factura"?"Pendiente de factura":"Cerrado sin factura"))}),invoicedExpenses.length===0&&React.createElement("div",{className:"text-center text-sm text-gray-500 py-6"},React.createElement("i",{className:"fas fa-file-invoice text-gray-400 text-2xl mb-2"}),React.createElement("p",null,"Aqu\xED se mostrar\xE1n los gastos que ya tienen factura conciliada."))))),React.createElement("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4"},React.createElement("div",{className:"flex items-center justify-between flex-wrap gap-3"},React.createElement("div",null,React.createElement("h4",{className:"font-medium text-gray-900"},"Resumen de Conciliaci\xF3n"),React.createElement("p",{className:"text-sm text-gray-600"},conciliatedPercentage,"% de los gastos con factura ya est\xE1n listos para conciliaci\xF3n bancaria.")),React.createElement("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm"},"\uD83D\uDCCA Reporte de conciliaci\xF3n"))))};var BankReconciliationContent=function BankReconciliationContent(_ref9){var expensesData=_ref9.expensesData,onUpdateExpense=_ref9.onUpdateExpense;var readyForBank=expensesData.filter(function(expense){return expense.estado_factura==="facturado"});var reconciledWithBank=readyForBank.filter(function(expense){return expense.movimiento_bancario});var pendingBankLink=readyForBank.filter(function(expense){return!expense.movimiento_bancario});var _useState19=useState(SAMPLE_BANK_MOVEMENTS),_useState20=_slicedToArray(_useState19,2),bankMovements=_useState20[0],setBankMovements=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),suggestionsByExpense=_useState22[0],setSuggestionsByExpense=_useState22[1];var _useState23=useState({}),_useState24=_slicedToArray(_useState23,2),loadingSuggestions=_useState24[0],setLoadingSuggestions=_useState24[1];var _useState25=useState({}),_useState26=_slicedToArray(_useState25,2),feedbackStatus=_useState26[0],setFeedbackStatus=_useState26[1];var fetchMovements=useCallback(_asyncToGenerator(_regenerator().m(function _callee5(){var response,data,_t4;return _regenerator().w(function(_context5){while(1)switch(_context5.p=_context5.n){case 0:_context5.p=0;_context5.n=1;return fetch("/bank_reconciliation/movements");case 1:response=_context5.v;if(response.ok){_context5.n=2;break}throw new Error("Error obteniendo movimientos bancarios");case 2:_context5.n=3;return response.json();case 3:data=_context5.v;if(data!==null&&data!==void 0&&data.movements){setBankMovements(data.movements)}_context5.n=5;break;case 4:_context5.p=4;_t4=_context5.v;console.error("Error fetching bank movements:",_t4);case 5:return _context5.a(2)}},_callee5,null,[[0,4]])})),[]);useEffect(function(){fetchMovements()},[fetchMovements]);var normalizeMovement=useCallback(function(movement){return _objectSpread(_objectSpread({},movement),{},{movement_id:movement.movement_id||movement.id,id:movement.movement_id||movement.id,amount:movement.amount||movement.monto||0,movement_date:movement.movement_date||movement.fecha||movement.fecha_movimiento,description:movement.description||movement.descripcion||"",bank:movement.bank||movement.banco||"",currency:movement.currency||movement.moneda||"MXN",tags:movement.tags||[]})},[]);var normalizedBankMovements=useMemo(function(){return bankMovements.map(normalizeMovement)},[bankMovements,normalizeMovement]);var movementIndex=useMemo(function(){var result={};normalizedBankMovements.forEach(function(movement){if(movement.movement_id){result[movement.movement_id]=movement}});return result},[normalizedBankMovements]);var assignedMovementIds=useMemo(function(){var identifiers=new Set;reconciledWithBank.forEach(function(expense){var linkedList=expense.movimientos_bancarios||[];if(linkedList.length>0){linkedList.forEach(function(linked){var identifier=linked.movement_id||linked.id;if(identifier){identifiers.add(identifier)}})}else{var linked=expense.movimiento_bancario||{};var identifier=linked.movement_id||linked.id;if(identifier){identifiers.add(identifier)}}});return identifiers},[reconciledWithBank]);var availableMovements=useMemo(function(){return normalizedBankMovements.filter(function(mov){return!assignedMovementIds.has(mov.movement_id)})},[normalizedBankMovements,assignedMovementIds]);var sendFeedback=useCallback(function(){var _ref10=_asyncToGenerator(_regenerator().m(function _callee6(_ref1){var expenseId,movementId,confidence,decision,metadata,_t5;return _regenerator().w(function(_context6){while(1)switch(_context6.p=_context6.n){case 0:expenseId=_ref1.expenseId,movementId=_ref1.movementId,confidence=_ref1.confidence,decision=_ref1.decision,metadata=_ref1.metadata;_context6.p=1;_context6.n=2;return fetch("/bank_reconciliation/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expense_id:expenseId,movement_id:movementId,confidence:confidence,decision:decision,metadata:metadata})});case 2:_context6.n=4;break;case 3:_context6.p=3;_t5=_context6.v;console.error("Error enviando feedback de conciliaci\xF3n bancaria:",_t5);case 4:return _context6.a(2)}},_callee6,null,[[1,3]])}));return function(_x){return _ref10.apply(this,arguments)}}(),[]);var handleLinkMovement=useCallback(function(expense,movementInput){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var movementsArray=Array.isArray(movementInput)?movementInput:movementInput?[movementInput]:[];if(movementsArray.length===0){onUpdateExpense(expense.id,function(){return{movimiento_bancario:null,movimientos_bancarios:[],estado_conciliacion:"pendiente_bancaria",fecha_conciliacion_bancaria:null,conciliacion_detalle:null}});setFeedbackStatus(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},expense.id,{type:"cleared",message:"Movimiento desasociado"}))});return}var normalizedArray=movementsArray.map(normalizeMovement);var totalConciliado=normalizedArray.reduce(function(sum,mov){return sum+(mov.amount||0)},0);onUpdateExpense(expense.id,function(){return{movimiento_bancario:normalizedArray[0],movimientos_bancarios:normalizedArray,estado_conciliacion:"conciliado_banco",fecha_conciliacion_bancaria:new Date().toISOString(),conciliacion_detalle:{movimientos:normalizedArray.length,total_conciliado:totalConciliado,origen:options.decision||"manual"}}});normalizedArray.forEach(function(mov){var _options$confidence,_options$decision;var movementId=mov.movement_id||mov.id;if(!movementId)return;sendFeedback({expenseId:expense.id,movementId:movementId,confidence:(_options$confidence=options.confidence)!==null&&_options$confidence!==void 0?_options$confidence:0,decision:(_options$decision=options.decision)!==null&&_options$decision!==void 0?_options$decision:"manual",metadata:_objectSpread(_objectSpread({},options.metadata||{}),{},{component_amount:mov.amount})})});setFeedbackStatus(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},expense.id,{type:options.decision==="accepted"?"accepted":"manual",message:options.decision==="accepted"?"Conciliaci\xF3n autom\xE1tica aplicada (".concat(normalizedArray.length," cargos)"):normalizedArray.length>1?"Relacionaste ".concat(normalizedArray.length," cargos manualmente"):"Movimiento asociado manualmente"}))})},[onUpdateExpense,sendFeedback,normalizeMovement]);var loadSuggestions=useCallback(function(){var _ref11=_asyncToGenerator(_regenerator().m(function _callee7(expense){var _expense$proveedor3,response,data,suggestions,_t6;return _regenerator().w(function(_context7){while(1)switch(_context7.p=_context7.n){case 0:_context7.p=0;setLoadingSuggestions(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},expense.id,true))});_context7.n=1;return fetch("/bank_reconciliation/suggestions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expense_id:expense.id,amount:expense.monto_total||expense.amount||0,currency:expense.currency||"MXN",description:expense.descripcion||expense.description,date:expense.fecha_gasto,provider_name:expense["proveedor.nombre"]||(typeof expense.proveedor==="string"?expense.proveedor:(_expense$proveedor3=expense.proveedor)===null||_expense$proveedor3===void 0?void 0:_expense$proveedor3.nombre),paid_by:expense.paid_by,metadata:{categoria:expense.categoria,forma_pago:expense.forma_pago}})});case 1:response=_context7.v;if(response.ok){_context7.n=2;break}throw new Error("Error obteniendo sugerencias");case 2:_context7.n=3;return response.json();case 3:data=_context7.v;suggestions=(data===null||data===void 0?void 0:data.suggestions)||[];setSuggestionsByExpense(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},expense.id,{suggestions:suggestions,top:suggestions.length>0?suggestions[0]:null}))});_context7.n=5;break;case 4:_context7.p=4;_t6=_context7.v;console.error("Error loading bank suggestions:",_t6);case 5:_context7.p=5;setLoadingSuggestions(function(prev){var next=_objectSpread({},prev);delete next[expense.id];return next});return _context7.f(5);case 6:return _context7.a(2)}},_callee7,null,[[0,4,5,6]])}));return function(_x2){return _ref11.apply(this,arguments)}}(),[]);useEffect(function(){pendingBankLink.forEach(function(expense){if(!suggestionsByExpense[expense.id]&&!loadingSuggestions[expense.id]){loadSuggestions(expense)}})},[pendingBankLink,suggestionsByExpense,loadingSuggestions,loadSuggestions]);var handleAcceptSuggestion=useCallback(function(expense,suggestionEntry){if(!suggestionEntry)return;var normalizedMovements=(suggestionEntry.movements||(suggestionEntry.movement?[suggestionEntry.movement]:[])).map(normalizeMovement);normalizedMovements.forEach(function(mov){if(!movementIndex[mov.movement_id]){setBankMovements(function(prev){return[].concat(_toConsumableArray(prev),[mov])})}});handleLinkMovement(expense,normalizedMovements,{decision:"accepted",confidence:suggestionEntry.confidence,metadata:{reasons:suggestionEntry.reasons,score_breakdown:suggestionEntry.score_breakdown}});setSuggestionsByExpense(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},expense.id,_objectSpread(_objectSpread({},prev[expense.id]),{},{accepted:true})))})},[handleLinkMovement,normalizeMovement,movementIndex]);var handleRejectSuggestion=useCallback(function(expense,suggestionEntry){if(!suggestionEntry)return;var normalizedMovements=(suggestionEntry.movements||(suggestionEntry.movement?[suggestionEntry.movement]:[])).map(normalizeMovement);normalizedMovements.forEach(function(movement){var movementId=movement.movement_id;if(!movementId)return;sendFeedback({expenseId:expense.id,movementId:movementId,confidence:suggestionEntry.confidence,decision:"rejected",metadata:{reasons:suggestionEntry.reasons,score_breakdown:suggestionEntry.score_breakdown}})});setSuggestionsByExpense(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},expense.id,_objectSpread(_objectSpread({},prev[expense.id]),{},{dismissed:true})))})},[normalizeMovement,sendFeedback]);var confidenceBadge=function confidenceBadge(confidence){if(confidence>=90)return"bg-green-100 text-green-800 border border-green-200";if(confidence>=75)return"bg-yellow-100 text-yellow-800 border border-yellow-200";return"bg-gray-100 text-gray-700 border border-gray-200"};return React.createElement("div",{className:"p-6 space-y-6"},React.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4"},React.createElement("h3",{className:"font-medium text-blue-800 mb-2"},"\uD83D\uDCB3 Conciliaci\xF3n bancaria"),React.createElement("p",{className:"text-sm text-blue-700"},"Vincula los gastos que ya tienen factura con el movimiento bancario correcto para cerrar el ciclo completo.")),React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},React.createElement("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h4",{className:"font-medium text-gray-900"},"Pendientes de asociar a banco"),React.createElement("span",{className:"text-sm text-gray-500"},pendingBankLink.length," gastos")),pendingBankLink.length===0&&React.createElement("div",{className:"text-center text-sm text-gray-500 py-8"},React.createElement("i",{className:"fas fa-check-circle text-green-500 text-3xl mb-2"}),React.createElement("p",null,"Todo lo facturado ya est\xE1 vinculado a un movimiento bancario.")),React.createElement("div",{className:"space-y-3 max-h-96 overflow-y-auto"},pendingBankLink.map(function(expense){var _suggestionsByExpense,_suggestionsByExpense2,_normalizedSuggestion,_normalizedSuggestion2,_normalizedSuggestion3,_normalizedSuggestion4;var suggestionEntry=((_suggestionsByExpense=suggestionsByExpense[expense.id])===null||_suggestionsByExpense===void 0?void 0:_suggestionsByExpense.top)||null;var movementsSource=(suggestionEntry===null||suggestionEntry===void 0?void 0:suggestionEntry.movements)||(suggestionEntry!==null&&suggestionEntry!==void 0&&suggestionEntry.movement?[suggestionEntry.movement]:[]);var normalizedSuggestionMovements=movementsSource.map(normalizeMovement);var combinedAmount=(suggestionEntry===null||suggestionEntry===void 0?void 0:suggestionEntry.combined_amount)||normalizedSuggestionMovements.reduce(function(s,mov){return s+(mov.amount||0)},0);var isLoading=!!loadingSuggestions[expense.id];var suggestionDismissed=(_suggestionsByExpense2=suggestionsByExpense[expense.id])===null||_suggestionsByExpense2===void 0?void 0:_suggestionsByExpense2.dismissed;return React.createElement("div",{key:expense.id,className:"border border-blue-200 bg-blue-50 rounded-lg p-4 space-y-3"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("p",{className:"font-medium text-gray-900"},expense.descripcion),React.createElement("p",{className:"text-xs text-gray-600"},"Factura ",expense.factura_id||"sin folio"," \u2022 ",expense.fecha_gasto)),React.createElement("span",{className:"text-sm font-semibold text-gray-900"},formatCurrency(expense.monto_total))),isLoading&&React.createElement("div",{className:"bg-white border border-blue-100 rounded-lg p-3 text-sm text-blue-600 flex items-center gap-2"},React.createElement("i",{className:"fas fa-spinner fa-spin"}),"Analizando movimientos bancarios\u2026"),!isLoading&&suggestionEntry&&!suggestionDismissed&&React.createElement("div",{className:"bg-white border border-blue-200 rounded-lg p-3 space-y-2"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("p",{className:"text-sm text-gray-800 font-medium"},suggestionEntry.type==="combination"?"Sugerencia IA (pago en ".concat(normalizedSuggestionMovements.length," cargos)"):"Sugerencia IA"),suggestionEntry.type==="combination"?React.createElement("p",{className:"text-xs text-gray-600"},normalizedSuggestionMovements.map(function(mov){return"".concat(mov.movement_date," \u2022 ").concat(mov.bank)}).join(" + ")):React.createElement("p",{className:"text-xs text-gray-600"},(_normalizedSuggestion=normalizedSuggestionMovements[0])===null||_normalizedSuggestion===void 0?void 0:_normalizedSuggestion.description)),React.createElement("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat(confidenceBadge(suggestionEntry.confidence))},"Confianza ",Math.round(suggestionEntry.confidence),"%")),React.createElement("div",{className:"text-xs text-gray-600 flex flex-wrap gap-2"},suggestionEntry.type==="combination"?React.createElement("span",null,React.createElement("strong",null,"Total")," \u2022 ",formatCurrency(combinedAmount)):React.createElement("span",null,React.createElement("strong",null,(_normalizedSuggestion2=normalizedSuggestionMovements[0])===null||_normalizedSuggestion2===void 0?void 0:_normalizedSuggestion2.movement_date)," \u2022 ",(_normalizedSuggestion3=normalizedSuggestionMovements[0])===null||_normalizedSuggestion3===void 0?void 0:_normalizedSuggestion3.bank),suggestionEntry.type==="combination"&&React.createElement("span",null,"Componentes: ",normalizedSuggestionMovements.map(function(mov){return formatCurrency(mov.amount)}).join(" + ")),suggestionEntry.type!=="combination"&&React.createElement("span",null,formatCurrency(((_normalizedSuggestion4=normalizedSuggestionMovements[0])===null||_normalizedSuggestion4===void 0?void 0:_normalizedSuggestion4.amount)||0))),React.createElement("div",{className:"text-xs text-gray-500 space-y-1"},suggestionEntry.reasons.map(function(reason,idx){return React.createElement("div",{key:idx,className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-check text-green-500"}),React.createElement("span",null,reason))})),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{onClick:function onClick(){return handleAcceptSuggestion(expense,suggestionEntry)},className:"flex-1 px-3 py-1 bg-green-600 text-white text-xs rounded-md hover:bg-green-700"},"\u2705 Aceptar sugerencia"),React.createElement("button",{onClick:function onClick(){return handleRejectSuggestion(expense,suggestionEntry)},className:"px-3 py-1 bg-white border border-red-200 text-red-600 text-xs rounded-md hover:bg-red-50"},"Rechazar"))),React.createElement("div",null,React.createElement("label",{className:"block text-xs text-gray-600 mb-1"},"Vincular con movimiento bancario"),React.createElement("select",{value:"",onChange:function onChange(e){var selected=movementIndex[e.target.value];if(selected){handleLinkMovement(expense,selected,{decision:"manual",metadata:{source:"manual_select"}})}},className:"w-full border border-gray-300 rounded-md text-sm p-2",disabled:availableMovements.length===0},React.createElement("option",{value:""},"Selecciona un movimiento"),availableMovements.map(function(movement){return React.createElement("option",{key:movement.movement_id,value:movement.movement_id},movement.movement_date," \u2022 ",movement.bank," \u2022 ",formatCurrency(movement.amount)," \u2192 ",movement.description)})),availableMovements.length===0&&React.createElement("p",{className:"text-xs text-gray-500 mt-2"},"Todos los movimientos disponibles ya est\xE1n asociados. Carga m\xE1s movimientos bancarios para continuar conciliando.")),feedbackStatus[expense.id]&&React.createElement("div",{className:"text-xs text-green-700 flex items-center gap-2"},React.createElement("i",{className:"fas fa-check-circle"}),React.createElement("span",null,feedbackStatus[expense.id].message)))}))),React.createElement("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h4",{className:"font-medium text-gray-900"},"Gastos conciliados con banco"),React.createElement("span",{className:"text-sm text-gray-500"},reconciledWithBank.length," gastos")),reconciledWithBank.length===0&&React.createElement("div",{className:"text-center text-sm text-gray-500 py-8"},React.createElement("i",{className:"fas fa-piggy-bank text-blue-500 text-3xl mb-2"}),React.createElement("p",null,"Aqu\xED aparecer\xE1n los gastos facturados que ya tienen un movimiento bancario asociado.")),React.createElement("div",{className:"space-y-3 max-h-96 overflow-y-auto"},reconciledWithBank.map(function(expense){var movimientos=expense.movimientos_bancarios||(expense.movimiento_bancario?[expense.movimiento_bancario]:[]);var totalConciliado=movimientos.reduce(function(sum,mov){return sum+(mov.amount||mov.monto||0)},0);return React.createElement("div",{key:expense.id,className:"border border-green-200 bg-green-50 rounded-lg p-4 space-y-2"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("p",{className:"font-medium text-gray-900"},expense.descripcion),React.createElement("p",{className:"text-xs text-gray-600"},"Factura ",expense.factura_id||"sin folio"," \u2022 ",expense.fecha_gasto)),React.createElement("span",{className:"text-sm font-semibold text-gray-900"},formatCurrency(totalConciliado||expense.monto_total))),React.createElement("div",{className:"text-xs text-green-700 space-y-1"},movimientos.map(function(mov,idx){return React.createElement("div",{key:idx,className:"flex items-center justify-between"},React.createElement("span",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-university"}),mov.bank," \u2022 ",mov.description),React.createElement("span",null,formatCurrency(mov.amount||mov.monto||0)))}),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-calendar-day"}),React.createElement("span",null,"Conciliado el ",new Date(expense.fecha_conciliacion_bancaria||expense.fecha_facturacion||new Date).toLocaleDateString("es-MX")))),React.createElement("div",{className:"mt-2 flex items-center gap-2"},React.createElement("a",{className:"text-blue-600 text-xs hover:underline",href:expense.factura_url||"#",target:"_blank",rel:"noopener noreferrer"},"Ver factura"),React.createElement("span",{className:"text-gray-400 text-xs"},"\u2022"),React.createElement("button",{onClick:function onClick(){return handleLinkMovement(expense,null)},className:"text-xs text-red-600 hover:text-red-700"},"Desasociar movimiento")),expense.conciliacion_detalle&&React.createElement("div",{className:"text-xs text-gray-500"},"Registro: ",expense.conciliacion_detalle.movimientos||movimientos.length," cargos \u2022 ",expense.conciliacion_detalle.origen==="accepted"?"Aceptado autom\xE1ticamente":"Manual"))})))),React.createElement("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4"},React.createElement("h4",{className:"font-medium text-gray-900 mb-2"},"Pr\xF3ximos pasos"),React.createElement("p",{className:"text-sm text-gray-600"},"Con esta informaci\xF3n podremos generar reportes por proveedor y por banco en la siguiente etapa. Ya tenemos identificados los gastos conciliados y listos para cruzarse con los movimientos bancarios.")))};var CompletenessView=function CompletenessView(_ref12){var expensesData=_ref12.expensesData,getCategoryInfo=_ref12.getCategoryInfo;var _useState27=useState(null),_useState28=_slicedToArray(_useState27,2),selectedExpense=_useState28[0],setSelectedExpense=_useState28[1];var _useState29=useState("todos"),_useState30=_slicedToArray(_useState29,2),filterStatus=_useState30[0],setFilterStatus=_useState30[1];console.log("\uD83D\uDD0D CompletenessView - expensesData:",expensesData===null||expensesData===void 0?void 0:expensesData.length,expensesData);console.log("\uD83D\uDD0D CompletenessView - getCategoryInfo:",_typeof(getCategoryInfo));if(!expensesData||expensesData.length===0){return React.createElement("div",{className:"p-6 text-center"},React.createElement("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},React.createElement("h3",{className:"font-medium text-yellow-800 mb-2"},"\u26A0\uFE0F No hay datos disponibles"),React.createElement("p",{className:"text-sm text-yellow-700 mb-4"},"No se encontraron gastos para mostrar. Esto puede deberse a:"),React.createElement("ul",{className:"text-sm text-yellow-700 text-left space-y-1"},React.createElement("li",null,"\u2022 Los datos dummy no se generaron correctamente"),React.createElement("li",null,"\u2022 Hay un error en la carga de datos"),React.createElement("li",null,"\u2022 El localStorage est\xE1 vac\xEDo")),React.createElement("button",{onClick:function onClick(){return window.location.reload()},className:"mt-4 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700"},"\uD83D\uDD04 Recargar p\xE1gina")))}var filteredExpenses=expensesData.filter(function(expense){var _expense$completitud;if(filterStatus==="todos")return true;return((_expense$completitud=expense.completitud)===null||_expense$completitud===void 0?void 0:_expense$completitud.estado)===filterStatus});var getCompletenessColor=function getCompletenessColor(estado){switch(estado){case"completo":return"text-green-600 bg-green-50 border-green-200";case"parcial":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"incompleto":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};var getStatusIcon=function getStatusIcon(estado){switch(estado){case"completo":return"\u2705";case"parcial":return"\u26A0\uFE0F";case"incompleto":return"\u274C";default:return"\u2753"}};return React.createElement("div",{className:"p-6 space-y-6"},React.createElement("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-4"},React.createElement("h3",{className:"font-medium text-indigo-800 mb-2"},"\uD83D\uDCCA Vista Contable y Completitud"),React.createElement("p",{className:"text-sm text-indigo-700"},"Revisa el estado contable y completitud de cada transacci\xF3n")),React.createElement("div",{className:"flex gap-3 mb-4"},["todos","completo","parcial","incompleto"].map(function(status){return React.createElement("button",{key:status,onClick:function onClick(){return setFilterStatus(status)},className:"px-3 py-1 text-sm rounded-lg border transition-colors ".concat(filterStatus===status?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50")},status==="todos"?"Todos":status.charAt(0).toUpperCase()+status.slice(1))})),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},["completo","parcial","incompleto"].map(function(estado){var count=expensesData.filter(function(exp){var _exp$completitud;return((_exp$completitud=exp.completitud)===null||_exp$completitud===void 0?void 0:_exp$completitud.estado)===estado}).length;var percentage=Math.round(count/expensesData.length*100)||0;return React.createElement("div",{key:estado,className:"p-4 rounded-lg border ".concat(getCompletenessColor(estado))},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("p",{className:"text-sm font-medium"},getStatusIcon(estado)," ",estado.charAt(0).toUpperCase()+estado.slice(1)),React.createElement("p",{className:"text-2xl font-bold"},count)),React.createElement("div",{className:"text-right"},React.createElement("p",{className:"text-sm"},percentage,"%"))))}),React.createElement("div",{className:"p-4 rounded-lg border bg-blue-50 border-blue-200 text-blue-600"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("p",{className:"text-sm font-medium"},"\uD83D\uDCC8 Total"),React.createElement("p",{className:"text-2xl font-bold"},expensesData.length)),React.createElement("div",{className:"text-right"},React.createElement("p",{className:"text-sm"},"100%"))))),React.createElement("div",{className:"space-y-3"},filteredExpenses.map(function(expense){var _expense$completitud2,_expense$completitud3,_expense$completitud4,_expense$proveedor4,_expense$asientos_con,_expense$completitud5;return React.createElement("div",{key:expense.id,className:"bg-white border border-gray-200 rounded-lg p-4"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(getCategoryInfo(expense.categoria).color)},getCategoryInfo(expense.categoria).label),React.createElement("h4",{className:"font-medium text-gray-900"},expense.descripcion)),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border ".concat(getCompletenessColor((_expense$completitud2=expense.completitud)===null||_expense$completitud2===void 0?void 0:_expense$completitud2.estado))},getStatusIcon((_expense$completitud3=expense.completitud)===null||_expense$completitud3===void 0?void 0:_expense$completitud3.estado)," ",((_expense$completitud4=expense.completitud)===null||_expense$completitud4===void 0?void 0:_expense$completitud4.porcentaje)||0,"% Completo"),React.createElement("span",{className:"text-lg font-bold text-gray-900"},"$",(expense.monto_total||0).toLocaleString("es-MX",{minimumFractionDigits:2})))),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},React.createElement("div",null,React.createElement("p",{className:"text-gray-600"},"Proveedor: ",expense["proveedor.nombre"]||(typeof expense.proveedor==="string"?expense.proveedor:(_expense$proveedor4=expense.proveedor)===null||_expense$proveedor4===void 0?void 0:_expense$proveedor4.nombre)||"Sin especificar"),React.createElement("p",{className:"text-gray-600"},"Fecha: ",expense.fecha_gasto),React.createElement("p",{className:"text-gray-600"},"RFC: ",expense.rfc||"N/A")),React.createElement("div",null,React.createElement("p",{className:"".concat(expense.estado_factura==="pendiente"?"text-orange-600":expense.estado_factura==="no_requiere"?"text-gray-500":"text-green-600")},"Estado factura: ",expense.estado_factura==="pendiente"?"\u23F3 Pendiente":expense.estado_factura==="no_requiere"?"\u2796 Sin factura":"\u2705 Facturado"),expense.factura_id&&React.createElement("p",{className:"text-gray-600"},"Factura: ",expense.factura_id),React.createElement("p",{className:"text-gray-600"},"Asiento: ",((_expense$asientos_con=expense.asientos_contables)===null||_expense$asientos_con===void 0?void 0:_expense$asientos_con.numero_poliza)||"N/A")),React.createElement("div",null,React.createElement("p",{className:"text-gray-600"},"CFDI requerido: ",expense.will_have_cfdi?"S\xED":"No"),React.createElement("p",{className:"text-gray-600"},"Pagado por: ",expense.paid_by==="company_account"?"Empresa":"Empleado"),React.createElement("p",{className:"text-gray-600"},"Forma de pago: ",expense.forma_pago||"N/A"))),React.createElement("div",{className:"mt-3 border-t border-gray-200 pt-3"},React.createElement("p",{className:"text-sm font-medium text-gray-700 mb-2"},"Criterios de completitud:"),React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs"},((_expense$completitud5=expense.completitud)===null||_expense$completitud5===void 0?void 0:_expense$completitud5.criterios)&&Object.entries(expense.completitud.criterios).map(function(_ref13){var _ref14=_slicedToArray(_ref13,2),key=_ref14[0],value=_ref14[1];return React.createElement("div",{key:key,className:"flex items-center gap-1 ".concat(value?"text-green-600":"text-red-600")},React.createElement("span",null,value?"\u2705":"\u274C"),React.createElement("span",null,key.replace(/_/g," ")))}))),React.createElement("div",{className:"flex gap-2 mt-3"},React.createElement("button",{onClick:function onClick(){return setSelectedExpense(selectedExpense===expense.id?null:expense.id)},className:"px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors"},selectedExpense===expense.id?"\uD83D\uDD3C":"\uD83D\uDD3D"," Ver Asientos Contables"),expense.estado_factura==="pendiente"&&React.createElement("button",{className:"px-3 py-1 bg-orange-600 text-white text-sm rounded-lg hover:bg-orange-700 transition-colors"},"\u26A1 Acelerar facturaci\xF3n")),selectedExpense===expense.id&&expense.asientos_contables&&React.createElement("div",{className:"mt-4 border-t border-gray-200 pt-4"},React.createElement("h5",{className:"font-medium text-gray-900 mb-3"},"\uD83D\uDCCB Asientos Contables"),React.createElement("div",{className:"bg-gray-50 rounded-lg p-4"},React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-3 text-sm"},React.createElement("div",null,React.createElement("p",null,React.createElement("strong",null,"P\xF3liza:")," ",expense.asientos_contables.numero_poliza),React.createElement("p",null,React.createElement("strong",null,"Tipo:")," ",expense.asientos_contables.tipo_poliza)),React.createElement("div",null,React.createElement("p",null,React.createElement("strong",null,"Fecha:")," ",expense.asientos_contables.fecha_asiento),React.createElement("p",null,React.createElement("strong",null,"Concepto:")," ",expense.asientos_contables.concepto))),React.createElement("div",{className:"overflow-x-auto"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",{className:"bg-gray-100"},React.createElement("tr",null,React.createElement("th",{className:"text-left p-2"},"Cuenta"),React.createElement("th",{className:"text-left p-2"},"Nombre de Cuenta"),React.createElement("th",{className:"text-right p-2"},"Debe"),React.createElement("th",{className:"text-right p-2"},"Haber"),React.createElement("th",{className:"text-left p-2"},"Tipo"))),React.createElement("tbody",null,expense.asientos_contables.movimientos.map(function(mov,index){return React.createElement("tr",{key:index,className:"border-t border-gray-200"},React.createElement("td",{className:"p-2 font-mono"},mov.cuenta),React.createElement("td",{className:"p-2"},mov.nombre_cuenta),React.createElement("td",{className:"p-2 text-right font-mono"},parseFloat(mov.debe)>0?"$".concat(parseFloat(mov.debe).toLocaleString("es-MX",{minimumFractionDigits:2})):"-"),React.createElement("td",{className:"p-2 text-right font-mono"},parseFloat(mov.haber)>0?"$".concat(parseFloat(mov.haber).toLocaleString("es-MX",{minimumFractionDigits:2})):"-"),React.createElement("td",{className:"p-2"},React.createElement("span",{className:"px-2 py-1 rounded text-xs ".concat(mov.tipo==="gasto"?"bg-red-100 text-red-800":mov.tipo==="iva_acreditable"?"bg-blue-100 text-blue-800":mov.tipo==="pasivo"?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800")},mov.tipo)))})),React.createElement("tfoot",{className:"bg-gray-100 font-semibold"},React.createElement("tr",null,React.createElement("td",{colSpan:"2",className:"p-2"},"TOTALES:"),React.createElement("td",{className:"p-2 text-right font-mono"},"$",parseFloat(expense.asientos_contables.total_debe).toLocaleString("es-MX",{minimumFractionDigits:2})),React.createElement("td",{className:"p-2 text-right font-mono"},"$",parseFloat(expense.asientos_contables.total_haber).toLocaleString("es-MX",{minimumFractionDigits:2})),React.createElement("td",{className:"p-2"},React.createElement("span",{className:"px-2 py-1 rounded text-xs ".concat(expense.asientos_contables.balanceado?"bg-green-100 text-green-800":"bg-red-100 text-red-800")},expense.asientos_contables.balanceado?"\u2705 Balanceado":"\u274C Desbalanceado")))))))))}),filteredExpenses.length===0&&React.createElement("div",{className:"text-center py-8 text-gray-500"},React.createElement("i",{className:"fas fa-search text-4xl mb-4"}),React.createElement("p",null,"No hay gastos que coincidan con el filtro seleccionado"))))};var NonReconciliationModal=function NonReconciliationModal(_ref15){var isOpen=_ref15.isOpen,onClose=_ref15.onClose,expense=_ref15.expense,onSubmit=_ref15.onSubmit;var _useState31=useState(""),_useState32=_slicedToArray(_useState31,2),selectedReason=_useState32[0],setSelectedReason=_useState32[1];var _useState33=useState(""),_useState34=_slicedToArray(_useState33,2),customReason=_useState34[0],setCustomReason=_useState34[1];var _useState35=useState(""),_useState36=_slicedToArray(_useState35,2),notes=_useState36[0],setNotes=_useState36[1];var _useState37=useState(""),_useState38=_slicedToArray(_useState37,2),estimatedDate=_useState38[0],setEstimatedDate=_useState38[1];var _useState39=useState([]),_useState40=_slicedToArray(_useState39,2),reasons=_useState40[0],setReasons=_useState40[1];var _useState41=useState(false),_useState42=_slicedToArray(_useState41,2),isLoading=_useState42[0],setIsLoading=_useState42[1];useEffect(function(){if(isOpen){fetchReasons()}},[isOpen]);var fetchReasons=function(){var _ref16=_asyncToGenerator(_regenerator().m(function _callee8(){var response,data,_t7;return _regenerator().w(function(_context8){while(1)switch(_context8.p=_context8.n){case 0:_context8.p=0;_context8.n=1;return fetch("/expenses/non-reconciliation-reasons");case 1:response=_context8.v;_context8.n=2;return response.json();case 2:data=_context8.v;setReasons(data.reasons);_context8.n=4;break;case 3:_context8.p=3;_t7=_context8.v;console.error("Error fetching reasons:",_t7);case 4:return _context8.a(2)}},_callee8,null,[[0,3]])}));return function fetchReasons(){return _ref16.apply(this,arguments)}}();var handleSubmit=function(){var _ref17=_asyncToGenerator(_regenerator().m(function _callee9(){var _reasons$find;var reasonText,data,response,result,_t8;return _regenerator().w(function(_context9){while(1)switch(_context9.p=_context9.n){case 0:if(selectedReason){_context9.n=1;break}alert("Por favor selecciona un motivo");return _context9.a(2);case 1:setIsLoading(true);reasonText=selectedReason==="other"?customReason:((_reasons$find=reasons.find(function(r){return r.code===selectedReason}))===null||_reasons$find===void 0?void 0:_reasons$find.title)||"";data={expense_id:expense.id,reason_code:selectedReason,reason_text:reasonText,notes:notes,estimated_resolution_date:estimatedDate||null};_context9.p=2;_context9.n=3;return fetch("/expenses/".concat(expense.id,"/mark-non-reconcilable"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});case 3:response=_context9.v;_context9.n=4;return response.json();case 4:result=_context9.v;if(result.success){alert("Gasto marcado como no conciliable: ".concat(result.message));onSubmit(result);onClose()}else{alert("Error: ".concat(result.message))}_context9.n=6;break;case 5:_context9.p=5;_t8=_context9.v;alert("Error: ".concat(_t8.message));case 6:_context9.p=6;setIsLoading(false);return _context9.f(6);case 7:return _context9.a(2)}},_callee9,null,[[2,5,6,7]])}));return function handleSubmit(){return _ref17.apply(this,arguments)}}();var handleClose=function handleClose(){setSelectedReason("");setCustomReason("");setNotes("");setEstimatedDate("");onClose()};if(!isOpen||!expense)return null;var selectedReasonData=reasons.find(function(r){return r.code===selectedReason});return React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},React.createElement("div",{className:"p-6 border-b border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"\u26A0\uFE0F Marcar como No Conciliable"),React.createElement("p",{className:"text-gray-600 mt-1"},"Gasto: ",expense.descripcion," - ",formatCurrency(expense.monto_total))),React.createElement("button",{onClick:handleClose,className:"text-gray-400 hover:text-gray-600"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement("div",{className:"p-6 space-y-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Motivo de no conciliaci\xF3n *"),React.createElement("select",{value:selectedReason,onChange:function onChange(e){return setSelectedReason(e.target.value)},className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"},React.createElement("option",{value:""},"Selecciona un motivo..."),reasons.map(function(reason){return React.createElement("option",{key:reason.code,value:reason.code},reason.title," - ",reason.description)}))),selectedReason==="other"&&React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Especifica el motivo *"),React.createElement("input",{type:"text",value:customReason,onChange:function onChange(e){return setCustomReason(e.target.value)},placeholder:"Describe el motivo espec\xEDfico...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})),selectedReasonData&&React.createElement("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3"},React.createElement("div",{className:"flex items-start space-x-3"},React.createElement("div",{className:"text-orange-600"},React.createElement("i",{className:"fas fa-info-circle"})),React.createElement("div",null,React.createElement("p",{className:"text-sm text-orange-800 font-medium"},selectedReasonData.description),React.createElement("p",{className:"text-xs text-orange-600 mt-1"},"Tiempo t\xEDpico de resoluci\xF3n: ",selectedReasonData.typical_resolution_days," d\xEDas")))),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Notas adicionales"),React.createElement("textarea",{value:notes,onChange:function onChange(e){return setNotes(e.target.value)},placeholder:"Detalles adicionales, acciones tomadas, etc...",rows:"3",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Fecha estimada de resoluci\xF3n"),React.createElement("input",{type:"date",value:estimatedDate,onChange:function onChange(e){return setEstimatedDate(e.target.value)},className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",min:new Date().toISOString().split("T")[0]}))),React.createElement("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3"},React.createElement("button",{onClick:handleClose,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:isLoading},"Cancelar"),React.createElement("button",{onClick:handleSubmit,disabled:!selectedReason||isLoading||selectedReason==="other"&&!customReason,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"},isLoading?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner fa-spin mr-2"}),"Procesando..."):"Marcar como No Conciliable"))))};var ConversationalAssistantModal=function ConversationalAssistantModal(_ref18){var onClose=_ref18.onClose;var _useState43=useState([{id:1,type:"assistant",content:"\xA1Hola! \uD83E\uDD16 Soy tu asistente de gastos con IA. Puedo ayudarte a consultar informaci\xF3n sobre tus gastos empresariales. \xBFQu\xE9 te gustar\xEDa saber?",timestamp:new Date}]),_useState44=_slicedToArray(_useState43,2),messages=_useState44[0],setMessages=_useState44[1];var _useState45=useState(""),_useState46=_slicedToArray(_useState45,2),currentQuery=_useState46[0],setCurrentQuery=_useState46[1];var _useState47=useState(false),_useState48=_slicedToArray(_useState47,2),isProcessing=_useState48[0],setIsProcessing=_useState48[1];var exampleQueries=["\xBFCu\xE1nto gast\xE9 este mes?","Mostrar gastos de combustible","Breakdown por categor\xEDas","Gastos de la semana pasada","Gastos en Pemex","Resumen general"];var sendQuery=function(){var _ref19=_asyncToGenerator(_regenerator().m(function _callee0(){var userMessage,response,result,assistantMessage,errorMessage,_t9;return _regenerator().w(function(_context0){while(1)switch(_context0.p=_context0.n){case 0:if(!(!currentQuery.trim()||isProcessing)){_context0.n=1;break}return _context0.a(2);case 1:userMessage={id:Date.now(),type:"user",content:currentQuery,timestamp:new Date};setMessages(function(prev){return[].concat(_toConsumableArray(prev),[userMessage])});setIsProcessing(true);_context0.p=2;_context0.n=3;return fetch("/expenses/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:currentQuery})});case 3:response=_context0.v;_context0.n=4;return response.json();case 4:result=_context0.v;assistantMessage={id:Date.now()+1,type:"assistant",content:result.answer,metadata:{query_type:result.query_type,confidence:result.confidence,has_llm:result.has_llm,sql_executed:result.sql_executed,data:result.data},timestamp:new Date};setMessages(function(prev){return[].concat(_toConsumableArray(prev),[assistantMessage])});_context0.n=6;break;case 5:_context0.p=5;_t9=_context0.v;errorMessage={id:Date.now()+1,type:"assistant",content:"\u274C Error procesando tu consulta: ".concat(_t9.message),timestamp:new Date};setMessages(function(prev){return[].concat(_toConsumableArray(prev),[errorMessage])});case 6:setCurrentQuery("");setIsProcessing(false);case 7:return _context0.a(2)}},_callee0,null,[[2,5]])}));return function sendQuery(){return _ref19.apply(this,arguments)}}();var handleKeyPress=function handleKeyPress(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendQuery()}};var setExampleQuery=function setExampleQuery(query){setCurrentQuery(query)};return React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col"},React.createElement("div",{className:"p-6 border-b border-gray-200 flex-shrink-0"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"\uD83E\uDD16 Asistente Conversacional IA"),React.createElement("p",{className:"text-gray-600 mt-1"},"Consulta informaci\xF3n sobre tus gastos en lenguaje natural")),React.createElement("button",{onClick:onClose,className:"text-gray-400 hover:text-gray-600"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement("div",{className:"p-4 bg-gray-50 border-b border-gray-200 flex-shrink-0"},React.createElement("p",{className:"text-sm text-gray-600 mb-3"},"Ejemplos de consultas:"),React.createElement("div",{className:"flex flex-wrap gap-2"},exampleQueries.map(function(query,index){return React.createElement("button",{key:index,onClick:function onClick(){return setExampleQuery(query)},className:"px-3 py-1 bg-blue-100 text-blue-700 text-sm rounded-full hover:bg-blue-200 transition-colors"},query)}))),React.createElement("div",{className:"flex-1 overflow-y-auto p-6 space-y-4"},messages.map(function(message){return React.createElement("div",{key:message.id,className:"flex ".concat(message.type==="user"?"justify-end":"justify-start")},React.createElement("div",{className:"max-w-[80%] p-4 rounded-lg ".concat(message.type==="user"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900 border-l-4 border-pink-500")},React.createElement("div",{className:"whitespace-pre-wrap"},message.content),message.metadata&&React.createElement("div",{className:"mt-3 pt-3 border-t border-gray-300 text-xs opacity-75"},React.createElement("div",{className:"flex items-center gap-4 flex-wrap"},React.createElement("span",null,"\uD83D\uDCCA ",message.metadata.query_type),React.createElement("span",null,"\uD83C\uDFAF ",(message.metadata.confidence*100).toFixed(1),"%"),React.createElement("span",null,"\uD83E\uDDE0 ",message.metadata.has_llm?"LLM":"Reglas")),message.metadata.sql_executed&&React.createElement("div",{className:"mt-2"},React.createElement("code",{className:"text-xs bg-gray-200 px-2 py-1 rounded"},message.metadata.sql_executed)),message.metadata.data&&Array.isArray(message.metadata.data)&&message.metadata.data.length>0&&React.createElement("div",{className:"mt-2 p-2 bg-green-50 rounded text-green-800"},React.createElement("strong",null,"\uD83D\uDCCB Datos encontrados: ",message.metadata.data.length," resultados"))),React.createElement("div",{className:"text-xs opacity-50 mt-2"},message.timestamp.toLocaleTimeString())))}),isProcessing&&React.createElement("div",{className:"flex justify-start"},React.createElement("div",{className:"bg-gray-100 p-4 rounded-lg border-l-4 border-pink-500"},React.createElement("div",{className:"flex items-center space-x-2"},React.createElement("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-pink-600"}),React.createElement("span",null,"Procesando tu consulta..."))))),React.createElement("div",{className:"p-4 border-t border-gray-200 flex-shrink-0"},React.createElement("div",{className:"flex gap-3"},React.createElement("input",{type:"text",value:currentQuery,onChange:function onChange(e){return setCurrentQuery(e.target.value)},onKeyPress:handleKeyPress,placeholder:"Escribe tu consulta aqu\xED...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",disabled:isProcessing}),React.createElement("button",{onClick:sendQuery,disabled:!currentQuery.trim()||isProcessing,className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"},isProcessing?React.createElement("i",{className:"fas fa-spinner fa-spin"}):React.createElement("i",{className:"fas fa-paper-plane"}))))))};var ExpenseRegistration=function ExpenseRegistration(){var _useState49=useState({}),_useState50=_slicedToArray(_useState49,2),formData=_useState50[0],setFormData=_useState50[1];var _useState51=useState(""),_useState52=_slicedToArray(_useState51,2),transcript=_useState52[0],setTranscript=_useState52[1];var _useState53=useState(false),_useState54=_slicedToArray(_useState53,2),isRecording=_useState54[0],setIsRecording=_useState54[1];var _useState55=useState(""),_useState56=_slicedToArray(_useState55,2),currentSummary=_useState56[0],setCurrentSummary=_useState56[1];var _useState57=useState(0),_useState58=_slicedToArray(_useState57,2),summaryConfidence=_useState58[0],setSummaryConfidence=_useState58[1];var _useState59=useState("voice"),_useState60=_slicedToArray(_useState59,2),inputMode=_useState60[0],setInputMode=_useState60[1];var _useState61=useState(0),_useState62=_slicedToArray(_useState61,2),audioLevel=_useState62[0],setAudioLevel=_useState62[1];var _useState63=useState(false),_useState64=_slicedToArray(_useState63,2),isUploading=_useState64[0],setIsUploading=_useState64[1];var _useState65=useState(null),_useState66=_slicedToArray(_useState65,2),ocrResult=_useState66[0],setOcrResult=_useState66[1];var _useState67=useState({status:"idle"}),_useState68=_slicedToArray(_useState67,2),invoiceParsing=_useState68[0],setInvoiceParsing=_useState68[1];var _useState69=useState(false),_useState70=_slicedToArray(_useState69,2),showExpensesDashboard=_useState70[0],setShowExpensesDashboard=_useState70[1];var _useState71=useState([]),_useState72=_slicedToArray(_useState71,2),expensesData=_useState72[0],setExpensesData=_useState72[1];var _useState73=useState(new Date().toISOString().slice(0,7)),_useState74=_slicedToArray(_useState73,2),selectedMonth=_useState74[0],setSelectedMonth=_useState74[1];var _useState75=useState("todos"),_useState76=_slicedToArray(_useState75,2),selectedCategoryFilter=_useState76[0],setSelectedCategoryFilter=_useState76[1];var _useState77=useState(false),_useState78=_slicedToArray(_useState77,2),showPendingInvoices=_useState78[0],setShowPendingInvoices=_useState78[1];var _useState79=useState(false),_useState80=_slicedToArray(_useState79,2),showInvoiceUpload=_useState80[0],setShowInvoiceUpload=_useState80[1];var _useState81=useState(false),_useState82=_slicedToArray(_useState81,2),showReconciliation=_useState82[0],setShowReconciliation=_useState82[1];var _useState83=useState(false),_useState84=_slicedToArray(_useState83,2),showBankReconciliation=_useState84[0],setShowBankReconciliation=_useState84[1];var _useState85=useState(false),_useState86=_slicedToArray(_useState85,2),showCompletenessView=_useState86[0],setShowCompletenessView=_useState86[1];var _useState87=useState(false),_useState88=_slicedToArray(_useState87,2),showConversationalAssistant=_useState88[0],setShowConversationalAssistant=_useState88[1];var _useState89=useState(false),_useState90=_slicedToArray(_useState89,2),showNonReconciliationModal=_useState90[0],setShowNonReconciliationModal=_useState90[1];var _useState91=useState(null),_useState92=_slicedToArray(_useState91,2),selectedExpenseForNonReconciliation=_useState92[0],setSelectedExpenseForNonReconciliation=_useState92[1];var _useState93=useState(false),_useState94=_slicedToArray(_useState93,2),moreActionsOpen=_useState94[0],setMoreActionsOpen=_useState94[1];var _useState95=useState(false),_useState96=_slicedToArray(_useState95,2),isSaving=_useState96[0],setIsSaving=_useState96[1];var _useState97=useState(false),_useState98=_slicedToArray(_useState97,2),isSending=_useState98[0],setIsSending=_useState98[1];var _useState99=useState(false),_useState100=_slicedToArray(_useState99,2),isCheckingDuplicates=_useState100[0],setIsCheckingDuplicates=_useState100[1];var _useState101=useState(false),_useState102=_slicedToArray(_useState101,2),isPredictingCategory=_useState102[0],setIsPredictingCategory=_useState102[1];var _useState103=useState(null),_useState104=_slicedToArray(_useState103,2),categoryPrediction=_useState104[0],setCategoryPrediction=_useState104[1];var _useState105=useState(null),_useState106=_slicedToArray(_useState105,2),lastSaveTime=_useState106[0],setLastSaveTime=_useState106[1];var normalizeExpense=useCallback(function(expense){var hasInvoice=!!expense.factura_id;var willHaveCfdi=expense.will_have_cfdi!==undefined?expense.will_have_cfdi:hasInvoice;var estadoFactura=expense.estado_factura||(willHaveCfdi?hasInvoice?"facturado":"pendiente":"no_requiere");if(!willHaveCfdi&&estadoFactura!=="sin_factura"){estadoFactura="sin_factura"}var movimientosBancarios=expense.movimientos_bancarios||(expense.movimiento_bancario?[expense.movimiento_bancario]:[]);var estadoConciliacion=expense.estado_conciliacion;if(!estadoConciliacion){if(estadoFactura==="facturado"){estadoConciliacion=movimientosBancarios.length>0?"conciliado_banco":"pendiente_bancaria"}else if(estadoFactura==="pendiente"){estadoConciliacion=hasInvoice?"pendiente_bancaria":"pendiente_factura"}else{estadoConciliacion="sin_factura"}}var workflowStatus="capturado";if(willHaveCfdi){if(estadoFactura==="facturado"){workflowStatus="facturado"}else if(estadoFactura==="sin_factura"){workflowStatus="cerrado_sin_factura"}else{workflowStatus="pendiente_factura"}}else{workflowStatus="cerrado_sin_factura"}var taxInfo=expense.tax_info||expense.tax_breakdown||null;var normalized=_objectSpread(_objectSpread({},expense),{},{will_have_cfdi:willHaveCfdi,estado_factura:estadoFactura,factura_url:hasInvoice?expense.factura_url||"https://erp.tuempresa.com/facturas/".concat(expense.factura_id):null,estado_conciliacion:estadoConciliacion,movimientos_bancarios:movimientosBancarios,movimiento_bancario:movimientosBancarios[0]||null,tax_info:taxInfo,workflow_status:workflowStatus,flujo_cerrado:workflowStatus!=="pendiente_factura"});normalized.asientos_contables=generateAccountingEntries(normalized);return normalized},[]);var updateExpense=useCallback(function(){var _ref20=_asyncToGenerator(_regenerator().m(function _callee1(expenseId,updatesProducer){var currentExpense,updates,updatedExpenseData,backendExpense,response,updatedExpense,normalizedExpense,_t0;return _regenerator().w(function(_context1){while(1)switch(_context1.p=_context1.n){case 0:_context1.p=0;currentExpense=expensesData.find(function(expense){return expense.id==expenseId});if(currentExpense){_context1.n=1;break}console.error("Gasto no encontrado para actualizar:",expenseId);return _context1.a(2);case 1:updates=typeof updatesProducer==="function"?updatesProducer(currentExpense):updatesProducer;updatedExpenseData=_objectSpread(_objectSpread({},currentExpense),updates);backendExpense={descripcion:updatedExpenseData.descripcion||"Gasto sin descripci\xF3n",monto_total:updatedExpenseData.monto_total||0,fecha_gasto:updatedExpenseData.fecha_gasto,categoria:updatedExpenseData.categoria,proveedor:updatedExpenseData.proveedor,rfc:updatedExpenseData.rfc,tax_info:updatedExpenseData.tax_info,asientos_contables:updatedExpenseData.asientos_contables,workflow_status:updatedExpenseData.workflow_status||"draft",estado_factura:updatedExpenseData.estado_factura||"pendiente",estado_conciliacion:updatedExpenseData.estado_conciliacion||"pendiente",forma_pago:updatedExpenseData.forma_pago,paid_by:updatedExpenseData.paid_by||"company_account",will_have_cfdi:updatedExpenseData.will_have_cfdi!==false,movimientos_bancarios:updatedExpenseData.movimientos_bancarios,metadata:updatedExpenseData.metadata||{}};_context1.n=2;return fetch("/expenses/".concat(expenseId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(backendExpense)});case 2:response=_context1.v;if(!response.ok){_context1.n=4;break}_context1.n=3;return response.json();case 3:updatedExpense=_context1.v;normalizedExpense=normalizeExpense(updatedExpense);setExpensesData(function(prevExpenses){var nextExpenses=prevExpenses.map(function(expense){if(expense.id==expenseId){return normalizedExpense}return expense});localStorage.setItem("expensesData",JSON.stringify(nextExpenses));return nextExpenses});console.log("\u2705 Gasto actualizado en backend:",normalizedExpense);_context1.n=5;break;case 4:throw new Error("Error del servidor: ".concat(response.status));case 5:_context1.n=7;break;case 6:_context1.p=6;_t0=_context1.v;console.error("Error actualizando gasto en backend:",_t0);setExpensesData(function(prevExpenses){var nextExpenses=prevExpenses.map(function(expense){if(expense.id!=expenseId){return expense}var updates=typeof updatesProducer==="function"?updatesProducer(expense):updatesProducer;return normalizeExpense(_objectSpread(_objectSpread({},expense),updates))});localStorage.setItem("expensesData",JSON.stringify(nextExpenses));return nextExpenses});console.warn("\u26A0\uFE0F Gasto actualizado en localStorage (fallback)");case 7:return _context1.a(2)}},_callee1,null,[[0,6]])}));return function(_x3,_x4){return _ref20.apply(this,arguments)}}(),[expensesData,setExpensesData,normalizeExpense]);var registerInvoiceForExpense=useCallback(function(){var _ref21=_asyncToGenerator(_regenerator().m(function _callee10(expenseId,payload){var response,message,updatedExpense,normalizedExpense;return _regenerator().w(function(_context10){while(1)switch(_context10.n){case 0:_context10.n=1;return fetch("/expenses/".concat(expenseId,"/invoice"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});case 1:response=_context10.v;if(response.ok){_context10.n=3;break}_context10.n=2;return response.text();case 2:message=_context10.v;throw new Error(message||"Error del servidor: ".concat(response.status));case 3:_context10.n=4;return response.json();case 4:updatedExpense=_context10.v;normalizedExpense=normalizeExpense(updatedExpense);setExpensesData(function(prevExpenses){var nextExpenses=prevExpenses.map(function(expense){return expense.id===expenseId?normalizedExpense:expense});localStorage.setItem("expensesData",JSON.stringify(nextExpenses));return nextExpenses});return _context10.a(2,normalizedExpense)}},_callee10)}));return function(_x5,_x6){return _ref21.apply(this,arguments)}}(),[normalizeExpense,setExpensesData]);var markExpenseAsInvoiced=useCallback(function(){var _ref22=_asyncToGenerator(_regenerator().m(function _callee11(expenseId){var response,message,updatedExpense,normalizedExpense;return _regenerator().w(function(_context11){while(1)switch(_context11.n){case 0:_context11.n=1;return fetch("/expenses/".concat(expenseId,"/mark-invoiced"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({actor:"ui"})});case 1:response=_context11.v;if(response.ok){_context11.n=3;break}_context11.n=2;return response.text();case 2:message=_context11.v;throw new Error(message||"Error del servidor: ".concat(response.status));case 3:_context11.n=4;return response.json();case 4:updatedExpense=_context11.v;normalizedExpense=normalizeExpense(updatedExpense);setExpensesData(function(prevExpenses){var nextExpenses=prevExpenses.map(function(expense){return expense.id===expenseId?normalizedExpense:expense});localStorage.setItem("expensesData",JSON.stringify(nextExpenses));return nextExpenses});return _context11.a(2,normalizedExpense)}},_callee11)}));return function(_x7){return _ref22.apply(this,arguments)}}(),[normalizeExpense,setExpensesData]);var closeExpenseWithoutInvoice=useCallback(function(){var _ref23=_asyncToGenerator(_regenerator().m(function _callee12(expenseId){var response,message,updatedExpense,normalizedExpense;return _regenerator().w(function(_context12){while(1)switch(_context12.n){case 0:_context12.n=1;return fetch("/expenses/".concat(expenseId,"/close-no-invoice"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({actor:"ui"})});case 1:response=_context12.v;if(response.ok){_context12.n=3;break}_context12.n=2;return response.text();case 2:message=_context12.v;throw new Error(message||"Error del servidor: ".concat(response.status));case 3:_context12.n=4;return response.json();case 4:updatedExpense=_context12.v;normalizedExpense=normalizeExpense(updatedExpense);setExpensesData(function(prevExpenses){var nextExpenses=prevExpenses.map(function(expense){return expense.id===expenseId?normalizedExpense:expense});localStorage.setItem("expensesData",JSON.stringify(nextExpenses));return nextExpenses});return _context12.a(2,normalizedExpense)}},_callee12)}));return function(_x8){return _ref23.apply(this,arguments)}}(),[normalizeExpense,setExpensesData]);var recognitionRef=useRef(null);var audioContextRef=useRef(null);var analyserRef=useRef(null);var microphoneRef=useRef(null);var animationFrameRef=useRef(null);var EXPENSE_FIELDS={"descripcion":{name:"Descripci\xF3n",type:"text",required:true,placeholder:"Describe el gasto...",help:"Descripci\xF3n breve del gasto realizado"},"monto_total":{name:"Monto Total",type:"number",required:true,placeholder:"0.00",help:"Monto total del gasto en pesos mexicanos"},"fecha_gasto":{name:"Fecha del Gasto",type:"date",required:true,help:"Fecha en que se realiz\xF3 el gasto"},"proveedor.nombre":{name:"Proveedor",type:"text",required:true,placeholder:"Nombre del proveedor...",help:"Nombre de la empresa o establecimiento"},"categoria":{name:"Categor\xEDa",type:"select",required:false,options:[{value:"combustible",label:"\u26FD Combustible"},{value:"alimentos",label:"\uD83C\uDF7D\uFE0F Alimentos y Bebidas"},{value:"transporte",label:"\uD83D\uDE97 Transporte"},{value:"hospedaje",label:"\uD83C\uDFE8 Hospedaje"},{value:"oficina",label:"\uD83D\uDCCB Material de Oficina"},{value:"tecnologia",label:"\uD83D\uDCBB Tecnolog\xEDa"},{value:"marketing",label:"\uD83D\uDCE2 Marketing"},{value:"capacitacion",label:"\uD83C\uDF93 Capacitaci\xF3n"},{value:"salud",label:"\uD83C\uDFE5 Salud"},{value:"otros",label:"\uD83D\uDCE6 Otros Gastos"}],help:"Categor\xEDa del gasto (detectada autom\xE1ticamente por IA)"},"forma_pago":{name:"Forma de Pago",type:"select",required:true,options:[{value:"efectivo",label:"Efectivo"},{value:"tarjeta_empresa",label:"Tarjeta de empresa"},{value:"tarjeta_empleado",label:"Tarjeta del empleado"},{value:"transferencia",label:"Transferencia"},{value:"spei",label:"SPEI"},{value:"pago_digital",label:"Pago Digital"}],help:"M\xE9todo de pago utilizado (detectado autom\xE1ticamente del ticket)"},"will_have_cfdi":{name:"\xBFSe va a facturar?",type:"select",required:true,options:[{value:true,label:"S\xED, habr\xE1 factura (CFDI)"},{value:false,label:"No, sin factura"}],help:"Indica si este gasto generar\xE1 una factura CFDI"},"paid_by":{name:"\xBFQui\xE9n pag\xF3?",type:"select",required:true,options:[{value:"company_account",label:"Empresa (tarjeta corporativa)"},{value:"own_account",label:"Empleado (reembolso)"}],help:"Indica si pag\xF3 la empresa o el empleado"},"rfc":{name:"RFC del Proveedor",type:"text",required:false,placeholder:"ABC123456DEF",help:"RFC necesario cuando se va a facturar"},"notas":{name:"Notas Adicionales",type:"textarea",required:false,placeholder:"Informaci\xF3n adicional del gasto...",help:"Cualquier informaci\xF3n adicional relevante"}};var getFieldValue=function getFieldValue(path){if(formData[path]!==undefined){return formData[path]}return path.split(".").reduce(function(current,key){return current===null||current===void 0?void 0:current[key]},formData)};var getFieldConfidence=function getFieldConfidence(fieldKey){var _formData$_confidence;return((_formData$_confidence=formData._confidence)===null||_formData$_confidence===void 0?void 0:_formData$_confidence[fieldKey])||0};var CATEGORIAS_DISPONIBLES=[{value:"combustible",label:"\u26FD Combustible",color:"bg-red-100 text-red-800"},{value:"alimentos",label:"\uD83C\uDF7D\uFE0F Alimentos y Bebidas",color:"bg-orange-100 text-orange-800"},{value:"transporte",label:"\uD83D\uDE97 Transporte",color:"bg-blue-100 text-blue-800"},{value:"hospedaje",label:"\uD83C\uDFE8 Hospedaje",color:"bg-purple-100 text-purple-800"},{value:"oficina",label:"\uD83D\uDCCB Material de Oficina",color:"bg-gray-100 text-gray-800"},{value:"tecnologia",label:"\uD83D\uDCBB Tecnolog\xEDa",color:"bg-indigo-100 text-indigo-800"},{value:"marketing",label:"\uD83D\uDCE2 Marketing",color:"bg-pink-100 text-pink-800"},{value:"capacitacion",label:"\uD83C\uDF93 Capacitaci\xF3n",color:"bg-green-100 text-green-800"},{value:"salud",label:"\uD83C\uDFE5 Salud",color:"bg-teal-100 text-teal-800"},{value:"otros",label:"\uD83D\uDCE6 Otros Gastos",color:"bg-yellow-100 text-yellow-800"}];var getCategoryInfo=function getCategoryInfo(categoryValue){return CATEGORIAS_DISPONIBLES.find(function(cat){return cat.value===categoryValue})||CATEGORIAS_DISPONIBLES[9]};var parseGasto=function parseGasto(transcript){var fields={};var confidence={};var summary="";var text=transcript.toLowerCase().trim();var montoPatterns=[/(\d+(?:[.,]\d+)?)\s*(?:mil\s*)?(?:pesos?|peso|mx|mxn|\$)/i,/\$\s*(\d+(?:[.,]\d+)?)/i,/(?:de|por|cuesta|vale)\s+(\d+(?:[.,]\d+)?)\s*(?:pesos?|peso)?/i];for(var _i=0,_montoPatterns=montoPatterns;_i<_montoPatterns.length;_i++){var pattern=_montoPatterns[_i];var match=transcript.match(pattern);if(match){var amount=parseFloat(match[1].replace(",","."));if(transcript.toLowerCase().includes("mil")){amount=amount*1000}fields.monto_total=amount;confidence.monto_total=0.85;break}}var proveedores=["pemex","oxxo","walmart","home depot","soriana","costco","liverpool"];for(var _i2=0,_proveedores=proveedores;_i2<_proveedores.length;_i2++){var proveedor=_proveedores[_i2];if(text.includes(proveedor)){fields["proveedor.nombre"]=proveedor.charAt(0).toUpperCase()+proveedor.slice(1);confidence["proveedor.nombre"]=0.9;break}}var categorias={"gasolina":"transporte","combustible":"transporte","taxi":"transporte","uber":"transporte","comida":"alimentacion","comidas":"alimentacion","almuerzo":"alimentacion","cena":"alimentacion","desayuno":"alimentacion","restaurante":"alimentacion","papeler\xEDa":"oficina","papel":"oficina","lapiceros":"oficina","plumas":"oficina","oficina":"oficina","limpieza":"mantenimiento","mantenimiento":"mantenimiento","reparaci\xF3n":"mantenimiento"};for(var _i3=0,_Object$entries=Object.entries(categorias);_i3<_Object$entries.length;_i3++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i3],2),palabra=_Object$entries$_i[0],categoria=_Object$entries$_i[1];if(text.includes(palabra)){fields.categoria=categoria;confidence.categoria=0.7;break}}if(text.includes("efectivo")){fields.forma_pago="efectivo";confidence.forma_pago=0.8}else if(text.includes("tarjeta empresa")||text.includes("tarjeta de la empresa")){fields.forma_pago="tarjeta_empresa";confidence.forma_pago=0.8}else if(text.includes("tarjeta empleado")||text.includes("tarjeta del empleado")){fields.forma_pago="tarjeta_empleado";confidence.forma_pago=0.8}if(transcript.length>0){var descripcion=transcript.trim();descripcion=descripcion.replace(/^(registrar|crear|gasto|de|un|el|la)\s+/i,"");fields.descripcion=descripcion;confidence.descripcion=0.7;summary="Gasto detectado: ".concat(descripcion.substring(0,60)).concat(descripcion.length>60?"...":"")}fields.fecha_gasto=new Date().toISOString().split("T")[0];confidence.fecha_gasto=1;var confidenceValues=Object.values(confidence);var overallConfidence=confidenceValues.length>0?confidenceValues.reduce(function(a,b){return a+b},0)/confidenceValues.length:0;return{fields:fields,confidence:confidence,summary:summary||"Procesando gasto...",overallConfidence:overallConfidence}};var handleFieldChange=useCallback(function(fieldKey,value){setFormData(function(prevData){var newData=_objectSpread({},prevData);newData[fieldKey]=value;if(!newData._manualEdits){newData._manualEdits={}}newData._manualEdits[fieldKey]=true;return newData})},[]);var parseInvoiceXml=useCallback(function(){var _ref24=_asyncToGenerator(_regenerator().m(function _callee13(file){var formDataXml,_data$emitter2,response,errorText,data,_t1;return _regenerator().w(function(_context13){while(1)switch(_context13.p=_context13.n){case 0:if(file){_context13.n=1;break}return _context13.a(2);case 1:setInvoiceParsing({status:"loading",filename:file.name});formDataXml=new FormData;formDataXml.append("file",file);_context13.p=2;_context13.n=3;return fetch("/invoices/parse",{method:"POST",body:formDataXml});case 3:response=_context13.v;if(response.ok){_context13.n=5;break}_context13.n=4;return response.text();case 4:errorText=_context13.v;throw new Error(errorText||"No se pudo analizar el XML");case 5:_context13.n=6;return response.json();case 6:data=_context13.v;setInvoiceParsing({status:"success",filename:file.name,data:data});setFormData(function(prev){var _data$emitter;return _objectSpread(_objectSpread({},prev),{},{tax_info:data,factura_uuid:data.uuid||prev.factura_uuid,factura_rfc_emisor:((_data$emitter=data.emitter)===null||_data$emitter===void 0?void 0:_data$emitter.Rfc)||prev.factura_rfc_emisor})});if(!getFieldValue("monto_total")&&data.total){handleFieldChange("monto_total",data.total)}if(!getFieldValue("rfc")&&(_data$emitter2=data.emitter)!==null&&_data$emitter2!==void 0&&_data$emitter2.Rfc){handleFieldChange("rfc",data.emitter.Rfc)}_context13.n=8;break;case 7:_context13.p=7;_t1=_context13.v;console.error("Error parsing invoice XML:",_t1);setInvoiceParsing({status:"error",filename:file.name,message:_t1.message||"Error analizando CFDI"});case 8:return _context13.a(2)}},_callee13,null,[[2,7]])}));return function(_x9){return _ref24.apply(this,arguments)}}(),[getFieldValue,handleFieldChange]);var handleXmlUpload=useCallback(function(file){if(!file)return;handleFieldChange("xml_file",file.name);handleFieldChange("will_have_cfdi",true);parseInvoiceXml(file)},[handleFieldChange,parseInvoiceXml]);useEffect(function(){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){var SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;recognitionRef.current=new SpeechRecognition;var recognition=recognitionRef.current;recognition.continuous=true;recognition.interimResults=true;recognition.lang="es-MX";recognition.onresult=function(event){var finalTranscript="";var interimTranscript="";for(var i=event.resultIndex;i<event.results.length;i++){var _transcript=event.results[i][0].transcript;if(event.results[i].isFinal){finalTranscript+=_transcript}else{interimTranscript+=_transcript}}var fullTranscript=transcript+finalTranscript+interimTranscript;setTranscript(fullTranscript);if(finalTranscript.trim()){var parseResult=parseGasto(fullTranscript);setFormData(function(prevData){return _objectSpread(_objectSpread(_objectSpread({},prevData),parseResult.fields),{},{_confidence:_objectSpread(_objectSpread({},prevData._confidence),parseResult.confidence)})});setCurrentSummary(parseResult.summary);setSummaryConfidence(parseResult.overallConfidence)}};recognition.onerror=function(event){console.error("Speech recognition error:",event.error);setIsRecording(false);if(event.error==="not-allowed"){alert("Necesitas dar permiso para usar el micr\xF3fono. Por favor recarga la p\xE1gina y acepta los permisos.")}};recognition.onend=function(){setIsRecording(false)}}return function(){if(recognitionRef.current){recognitionRef.current.stop()}}},[]);var handleToggleRecording=useCallback(function(){if(!recognitionRef.current){alert("Tu navegador no soporta reconocimiento de voz. Usa Chrome, Edge o Safari.");return}if(isRecording){recognitionRef.current.stop();setIsRecording(false)}else{try{recognitionRef.current.start();setIsRecording(true);setTranscript("")}catch(error){console.error("Error starting speech recognition:",error);alert("Error al iniciar el reconocimiento de voz. Aseg\xFArate de dar permisos al micr\xF3fono.")}}},[isRecording]);var handleOcrUpload=useCallback(function(){var _ref25=_asyncToGenerator(_regenerator().m(function _callee14(file){var _formData,response,result,mappedFields,mappedConfidence,descripcion,summary,_t10;return _regenerator().w(function(_context14){while(1)switch(_context14.p=_context14.n){case 0:if(file){_context14.n=1;break}return _context14.a(2);case 1:setIsUploading(true);setOcrResult(null);_context14.p=2;_formData=new FormData;_formData.append("file",file);_formData.append("paid_by","company_account");_formData.append("will_have_cfdi","true");_context14.n=3;return fetch("http://localhost:3001/ocr/intake",{method:"POST",body:_formData});case 3:response=_context14.v;if(response.ok){_context14.n=4;break}throw new Error("Error ".concat(response.status,": ").concat(response.statusText));case 4:_context14.n=5;return response.json();case 5:result=_context14.v;setOcrResult(result);if(result.fields){mappedFields={};mappedConfidence={};if(result.fields.proveedor){mappedFields["proveedor.nombre"]=result.fields.proveedor;mappedConfidence["proveedor.nombre"]=0.8}if(result.fields.total&&result.fields.total>0){mappedFields["monto_total"]=result.fields.total;mappedConfidence["monto_total"]=0.9}if(result.fields.fecha){mappedFields["fecha_gasto"]=result.fields.fecha;mappedConfidence["fecha_gasto"]=0.8}if(result.fields.rfc){mappedFields["rfc"]=result.fields.rfc;mappedConfidence["rfc"]=0.7}if(result.fields.categoria){mappedFields["categoria"]=result.fields.categoria.toLowerCase();mappedConfidence["categoria"]=result.fields.confianza_categoria||0.8}if(result.fields.forma_pago){mappedFields["forma_pago"]=result.fields.forma_pago;mappedConfidence["forma_pago"]=0.9}descripcion="";if(result.fields.descripcion_inteligente){descripcion=result.fields.descripcion_inteligente}else if(result.fields.proveedor){descripcion="Gasto en ".concat(result.fields.proveedor);if(result.fields.total){descripcion+=" por $".concat(result.fields.total)}descripcion+=" (detectado por OCR)"}else{descripcion="Gasto detectado por OCR"}mappedFields["descripcion"]=descripcion;mappedConfidence["descripcion"]=0.7;mappedFields["will_have_cfdi"]=result.fields.rfc?true:false;mappedFields["paid_by"]="company_account";mappedConfidence["will_have_cfdi"]=result.fields.rfc?0.8:0.6;mappedConfidence["paid_by"]=0.6;setFormData(function(prevData){return _objectSpread(_objectSpread(_objectSpread({},prevData),mappedFields),{},{_confidence:_objectSpread(_objectSpread({},prevData._confidence),mappedConfidence),_ocrIntakeId:result.intake_id})});summary="OCR procesado exitosamente";if(result.fields.proveedor&&result.fields.total){summary="OCR detect\xF3: ".concat(result.fields.proveedor," - $").concat(result.fields.total)}else if(result.fields.proveedor){summary="OCR detect\xF3 proveedor: ".concat(result.fields.proveedor)}else if(result.fields.total){summary="OCR detect\xF3 monto: $".concat(result.fields.total)}setCurrentSummary(summary);setSummaryConfidence(result.confidence||0.8)}_context14.n=7;break;case 6:_context14.p=6;_t10=_context14.v;console.error("Error en OCR:",_t10);alert("Error procesando archivo con OCR: "+_t10.message);case 7:_context14.p=7;setIsUploading(false);return _context14.f(7);case 8:return _context14.a(2)}},_callee14,null,[[2,6,7,8]])}));return function(_x0){return _ref25.apply(this,arguments)}}(),[]);var handleTextInput=useCallback(function(textInput){if(!textInput.trim())return;var parseResult=parseGasto(textInput);setFormData(function(prevData){return _objectSpread(_objectSpread(_objectSpread({},prevData),parseResult.fields),{},{_confidence:_objectSpread(_objectSpread({},prevData._confidence),parseResult.confidence)})});setCurrentSummary(parseResult.summary);setSummaryConfidence(parseResult.overallConfidence);setTranscript(textInput)},[]);var handleSaveDraft=useCallback(_asyncToGenerator(_regenerator().m(function _callee15(){var _t11;return _regenerator().w(function(_context15){while(1)switch(_context15.p=_context15.n){case 0:setIsSaving(true);_context15.p=1;_context15.n=2;return new Promise(function(resolve){return setTimeout(resolve,1000)});case 2:setLastSaveTime(new Date);console.log("Borrador guardado:",formData);_context15.n=4;break;case 3:_context15.p=3;_t11=_context15.v;console.error("Error guardando borrador:",_t11);alert("Error al guardar el borrador");case 4:_context15.p=4;setIsSaving(false);return _context15.f(4);case 5:return _context15.a(2)}},_callee15,null,[[1,3,4,5]])})),[formData]);var handleSendToOdoo=useCallback(_asyncToGenerator(_regenerator().m(function _callee16(){var preliminaryData,duplicateResult,userWantsToContinue,expenseData,paymentMode,enrichedDescription,attachments,odooData,response,expenseRouterData,routerResponse,routerResult,routeResponse,routeResult,result,savedExpense,_t12,_t13;return _regenerator().w(function(_context16){while(1)switch(_context16.p=_context16.n){case 0:setIsSending(true);_context16.p=1;console.log("\uD83D\uDD0D Verificando duplicados antes de enviar...");preliminaryData={descripcion:getFieldValue("descripcion"),monto_total:getFieldValue("monto_total"),fecha_gasto:getFieldValue("fecha_gasto"),proveedor:getFieldValue("proveedor.nombre"),categoria:getFieldValue("categoria"),forma_pago:getFieldValue("forma_pago"),will_have_cfdi:getFieldValue("will_have_cfdi"),paid_by:getFieldValue("paid_by"),rfc:getFieldValue("rfc")};_context16.n=2;return checkForDuplicates(preliminaryData);case 2:duplicateResult=_context16.v;if(!duplicateResult.has_duplicates){_context16.n=5;break}_context16.n=3;return showDuplicateAlert(duplicateResult,preliminaryData);case 3:userWantsToContinue=_context16.v;if(userWantsToContinue){_context16.n=4;break}console.log("\uD83D\uDEAB Usuario cancel\xF3 por duplicado detectado");return _context16.a(2);case 4:console.log("\u2705 Usuario decidi\xF3 continuar a pesar del duplicado");case 5:expenseData={descripcion:getFieldValue("descripcion"),monto_total:getFieldValue("monto_total"),fecha_gasto:getFieldValue("fecha_gasto"),proveedor:getFieldValue("proveedor.nombre"),categoria:getFieldValue("categoria"),forma_pago:getFieldValue("forma_pago"),will_have_cfdi:getFieldValue("will_have_cfdi"),paid_by:getFieldValue("paid_by"),rfc:getFieldValue("rfc"),notas:getFieldValue("notas"),ticket_file:getFieldValue("ticket_file"),xml_file:getFieldValue("xml_file"),pdf_file:getFieldValue("pdf_file"),tax_info:formData.tax_info||null,factura_uuid:formData.factura_uuid||null};paymentMode="own_account";if(getFieldValue("paid_by")==="company_account"){paymentMode="company_account"}else if(getFieldValue("forma_pago")==="tarjeta_empresa"){paymentMode="company_account"}enrichedDescription=getFieldValue("descripcion")||"Gasto registrado por voz";if(getFieldValue("will_have_cfdi")){enrichedDescription+=" [CFDI: S\xED]"}else{enrichedDescription+=" [CFDI: No]"}if(getFieldValue("rfc")){enrichedDescription+=" [RFC: ".concat(getFieldValue("rfc"),"]")}if(getFieldValue("notas")){enrichedDescription+=" - ".concat(getFieldValue("notas"))}attachments=[];if(getFieldValue("ticket_file"))attachments.push("Ticket");if(getFieldValue("xml_file"))attachments.push("XML");if(getFieldValue("pdf_file"))attachments.push("PDF");if(attachments.length>0){enrichedDescription+=" [Adjuntos: ".concat(attachments.join(", "),"]")}odooData={name:enrichedDescription,total_amount:getFieldValue("monto_total")||0,date:getFieldValue("fecha_gasto")||new Date().toISOString().split("T")[0],employee_id:1,payment_mode:paymentMode,description:enrichedDescription,price_unit:getFieldValue("monto_total")||0,quantity:1};console.log("Enviando datos a Odoo:",odooData);_context16.p=6;expenseRouterData={paid_by:getFieldValue("paid_by")||(paymentMode==="company_account"?"company_account":"own_account"),will_have_cfdi:getFieldValue("will_have_cfdi")||false,total:getFieldValue("monto_total")||0,date:getFieldValue("fecha_gasto")||new Date().toISOString().split("T")[0],provider_name:getFieldValue("proveedor.nombre")||"Proveedor sin nombre",rfc:getFieldValue("rfc")};console.log("Intentando con Expense Router:",expenseRouterData);_context16.n=7;return fetch("http://localhost:3001/intake",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(expenseRouterData)});case 7:routerResponse=_context16.v;if(!routerResponse.ok){_context16.n=11;break}_context16.n=8;return routerResponse.json();case 8:routerResult=_context16.v;console.log("Expense Router exitoso:",routerResult);_context16.n=9;return fetch("http://localhost:3001/route/".concat(routerResult.intake_id,"/decide"),{method:"POST"});case 9:routeResponse=_context16.v;if(!routeResponse.ok){_context16.n=11;break}_context16.n=10;return routeResponse.json();case 10:routeResult=_context16.v;console.log("Decisi\xF3n de ruta:",routeResult);alert("\xA1Gasto procesado exitosamente!\nRuta: ".concat(routeResult.route,"\nMotivo: ").concat(routeResult.reason));setFormData({});setInvoiceParsing({status:"idle"});setTranscript("");setCurrentSummary("");setSummaryConfidence(0);return _context16.a(2);case 11:_context16.n=13;break;case 12:_context16.p=12;_t12=_context16.v;console.log("Expense Router no disponible, usando endpoint directo de Odoo:",_t12.message);case 13:_context16.n=14;return fetch("/simple_expense",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(odooData)});case 14:response=_context16.v;_context16.n=15;return response.json();case 15:result=_context16.v;if(!result.success){_context16.n=17;break}_context16.n=16;return saveExpenseToDatabase(expenseData,true);case 16:savedExpense=_context16.v;alert("\xA1Gasto enviado a Odoo y guardado localmente exitosamente!");setFormData({});setInvoiceParsing({status:"idle"});setTranscript("");setCurrentSummary("");setSummaryConfidence(0);_context16.n=18;break;case 17:throw new Error(result.error||"Error desconocido");case 18:_context16.n=20;break;case 19:_context16.p=19;_t13=_context16.v;console.error("Error enviando a Odoo:",_t13);alert("Error al enviar el gasto a Odoo: "+_t13.message);case 20:_context16.p=20;setIsSending(false);return _context16.f(20);case 21:return _context16.a(2)}},_callee16,null,[[6,12],[1,19,20,21]])})),[formData]);var calculateProgress=function calculateProgress(){var requiredFields=["descripcion","monto_total","fecha_gasto","proveedor.nombre","forma_pago","will_have_cfdi","paid_by"];var completedRequired=requiredFields.filter(function(field){var value=getFieldValue(field);return value!==undefined&&value!==null&&value!==""}).length;return Math.round(completedRequired/requiredFields.length*100)};useEffect(function(){var loadExpenses=function(){var _ref28=_asyncToGenerator(_regenerator().m(function _callee17(){var response,backendExpenses,dummyExpenses,savedExpenses,_iterator,_step,dummyExpense,createResponse,savedExpense,normalizedDummy,normalizedExpenses,_savedExpenses,_normalizedExpenses,_savedExpenses2,_normalizedExpenses2,_t14,_t15,_t16;return _regenerator().w(function(_context17){while(1)switch(_context17.p=_context17.n){case 0:_context17.p=0;_context17.n=1;return fetch("/expenses");case 1:response=_context17.v;if(!response.ok){_context17.n=17;break}_context17.n=2;return response.json();case 2:backendExpenses=_context17.v;if(!(backendExpenses.length===0)){_context17.n=15;break}dummyExpenses=generateDummyExpenses();console.log("\uD83C\uDFAF Creando datos dummy en el backend...");savedExpenses=[];_iterator=_createForOfIteratorHelper(dummyExpenses);_context17.p=3;_iterator.s();case 4:if((_step=_iterator.n()).done){_context17.n=11;break}dummyExpense=_step.value;_context17.p=5;_context17.n=6;return fetch("/expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(dummyExpense)});case 6:createResponse=_context17.v;if(!createResponse.ok){_context17.n=8;break}_context17.n=7;return createResponse.json();case 7:savedExpense=_context17.v;savedExpenses.push(savedExpense);case 8:_context17.n=10;break;case 9:_context17.p=9;_t14=_context17.v;console.error("Error creando gasto dummy:",_t14);case 10:_context17.n=4;break;case 11:_context17.n=13;break;case 12:_context17.p=12;_t15=_context17.v;_iterator.e(_t15);case 13:_context17.p=13;_iterator.f();return _context17.f(13);case 14:normalizedDummy=savedExpenses.map(normalizeExpense);setExpensesData(normalizedDummy);console.log("\uD83C\uDFAF Datos dummy creados en backend:",normalizedDummy.length);_context17.n=16;break;case 15:normalizedExpenses=backendExpenses.map(normalizeExpense);setExpensesData(normalizedExpenses);console.log("\uD83D\uDCCB Gastos cargados desde backend:",normalizedExpenses.length);case 16:_context17.n=18;break;case 17:console.error("Error cargando gastos del backend:",response.status);_savedExpenses=JSON.parse(localStorage.getItem("expensesData")||"[]");_normalizedExpenses=_savedExpenses.map(normalizeExpense);setExpensesData(_normalizedExpenses);console.log("\uD83D\uDCCB Gastos cargados desde localStorage (fallback):",_normalizedExpenses.length);case 18:_context17.n=20;break;case 19:_context17.p=19;_t16=_context17.v;console.error("Error conectando al backend:",_t16);_savedExpenses2=JSON.parse(localStorage.getItem("expensesData")||"[]");_normalizedExpenses2=_savedExpenses2.map(normalizeExpense);setExpensesData(_normalizedExpenses2);console.log("\uD83D\uDCCB Gastos cargados desde localStorage (fallback):",_normalizedExpenses2.length);case 20:return _context17.a(2)}},_callee17,null,[[5,9],[3,12,13,14],[0,19]])}));return function loadExpenses(){return _ref28.apply(this,arguments)}}();loadExpenses()},[normalizeExpense]);var predictCategory=function(){var _ref29=_asyncToGenerator(_regenerator().m(function _callee18(description){var amount,providerName,response,result,_args18=arguments,_t17;return _regenerator().w(function(_context18){while(1)switch(_context18.p=_context18.n){case 0:amount=_args18.length>1&&_args18[1]!==undefined?_args18[1]:null;providerName=_args18.length>2&&_args18[2]!==undefined?_args18[2]:null;if(!(!description||description.length<3)){_context18.n=1;break}return _context18.a(2,null);case 1:setIsPredictingCategory(true);_context18.p=2;_context18.n=3;return fetch("/expenses/predict-category",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:description,amount:amount,provider_name:providerName,include_history:true})});case 3:response=_context18.v;if(!response.ok){_context18.n=5;break}_context18.n=4;return response.json();case 4:result=_context18.v;console.log("\uD83E\uDD16 Category prediction result:",result);setCategoryPrediction(result);if(result.confianza>=0.8&&!getFieldValue("categoria")){handleFieldChange("categoria",result.categoria_sugerida);console.log("\u2705 Auto-aplicada categor\xEDa: ".concat(result.categoria_sugerida," (confianza: ").concat(result.confianza,")"))}return _context18.a(2,result);case 5:console.warn("Error predicting category:",response.status);return _context18.a(2,null);case 6:_context18.n=8;break;case 7:_context18.p=7;_t17=_context18.v;console.error("Error predicting category:",_t17);return _context18.a(2,null);case 8:_context18.p=8;setIsPredictingCategory(false);return _context18.f(8);case 9:return _context18.a(2)}},_callee18,null,[[2,7,8,9]])}));return function predictCategory(_x1){return _ref29.apply(this,arguments)}}();useEffect(function(){var description=getFieldValue("descripcion");var amount=getFieldValue("monto_total");var providerName=getFieldValue("proveedor.nombre");if(description&&description.length>=3&&!getFieldValue("categoria")){var timeoutId=setTimeout(function(){predictCategory(description,amount,providerName)},1500);return function(){return clearTimeout(timeoutId)}}},[formData.descripcion,formData.monto_total,formData["proveedor.nombre"]]);var checkForDuplicates=function(){var _ref30=_asyncToGenerator(_regenerator().m(function _callee19(expenseData){var duplicateCheckData,response,result,_t18;return _regenerator().w(function(_context19){while(1)switch(_context19.p=_context19.n){case 0:setIsCheckingDuplicates(true);_context19.p=1;duplicateCheckData={new_expense:{descripcion:expenseData.descripcion||"Gasto sin descripci\xF3n",monto_total:expenseData.monto_total||0,fecha_gasto:expenseData.fecha_gasto,categoria:expenseData.categoria,proveedor:expenseData.proveedor?{nombre:expenseData.proveedor}:null,rfc:expenseData.rfc,workflow_status:"draft",estado_factura:"pendiente",estado_conciliacion:"pendiente",forma_pago:expenseData.forma_pago,paid_by:expenseData.paid_by||"company_account",will_have_cfdi:expenseData.will_have_cfdi!==false},check_existing:true};_context19.n=2;return fetch("/expenses/check-duplicates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(duplicateCheckData)});case 2:response=_context19.v;if(!response.ok){_context19.n=4;break}_context19.n=3;return response.json();case 3:result=_context19.v;console.log("\uD83D\uDD0D Duplicate check result:",result);return _context19.a(2,result);case 4:console.warn("Error checking duplicates:",response.status);return _context19.a(2,{has_duplicates:false,recommendation:"proceed"});case 5:_context19.n=7;break;case 6:_context19.p=6;_t18=_context19.v;console.error("Error checking duplicates:",_t18);return _context19.a(2,{has_duplicates:false,recommendation:"proceed"});case 7:_context19.p=7;setIsCheckingDuplicates(false);return _context19.f(7);case 8:return _context19.a(2)}},_callee19,null,[[1,6,7,8]])}));return function checkForDuplicates(_x10){return _ref30.apply(this,arguments)}}();var showDuplicateAlert=function showDuplicateAlert(duplicateResult,newExpenseData){return new Promise(function(resolve){if(!duplicateResult.has_duplicates){resolve(true);return}var topMatch=duplicateResult.duplicates[0];var existing=topMatch.existing_expense;var message="\u26A0\uFE0F POSIBLE GASTO DUPLICADO DETECTADO\n\n";message+="\uD83D\uDD0D Confianza: ".concat(topMatch.confidence_level.toUpperCase(),"\n");message+="\uD83D\uDCCA Similitud: ".concat((topMatch.similarity_score*100).toFixed(1),"%\n\n");message+="\uD83D\uDCDD GASTO NUEVO:\n";message+="\u2022 ".concat(newExpenseData.descripcion||"N/A","\n");message+="\u2022 $".concat(newExpenseData.monto_total||0,"\n");message+="\u2022 ".concat(newExpenseData.fecha_gasto||"N/A","\n");if(newExpenseData.proveedor){message+="\u2022 Proveedor: ".concat(newExpenseData.proveedor,"\n")}message+="\n";message+="\uD83D\uDCCB GASTO EXISTENTE:\n";message+="\u2022 ".concat(existing.descripcion,"\n");message+="\u2022 $".concat(existing.monto_total,"\n");message+="\u2022 ".concat(existing.fecha_gasto||"N/A","\n\n");message+="\uD83C\uDFAF RAZONES:\n";topMatch.match_reasons.forEach(function(reason){message+="\u2022 ".concat(reason,"\n")});message+="\n\xBFDeseas continuar de todos modos?";if(duplicateResult.risk_level==="high"){message+="\n\n\uD83D\uDEAB RECOMENDACI\xD3N: NO continuar (muy probable duplicado)"}else if(duplicateResult.risk_level==="medium"){message+="\n\n\u26A0\uFE0F RECOMENDACI\xD3N: Revisar cuidadosamente"}var userChoice=confirm(message);resolve(userChoice)})};var saveExpenseToDatabase=function(){var _ref31=_asyncToGenerator(_regenerator().m(function _callee20(expenseData){var skipDuplicateCheck,duplicateResult,userWantsToContinue,_hasInvoice,_estadoFactura,_estadoConciliacion,backendExpense,response,savedExpense,normalizedExpense,errorData,_normalizedExpense,currentExpenses,updatedExpenses,_args20=arguments,_t19;return _regenerator().w(function(_context20){while(1)switch(_context20.p=_context20.n){case 0:skipDuplicateCheck=_args20.length>1&&_args20[1]!==undefined?_args20[1]:false;_context20.p=1;if(skipDuplicateCheck){_context20.n=5;break}console.log("\uD83D\uDD0D Verificando duplicados antes de guardar...");_context20.n=2;return checkForDuplicates(expenseData);case 2:duplicateResult=_context20.v;if(!duplicateResult.has_duplicates){_context20.n=5;break}_context20.n=3;return showDuplicateAlert(duplicateResult,expenseData);case 3:userWantsToContinue=_context20.v;if(userWantsToContinue){_context20.n=4;break}console.log("\uD83D\uDEAB Usuario cancel\xF3 por duplicado detectado");return _context20.a(2,null);case 4:console.log("\u2705 Usuario decidi\xF3 continuar a pesar del duplicado");case 5:_hasInvoice=!!expenseData.factura_id;_estadoFactura=_hasInvoice?"facturado":expenseData.will_have_cfdi?"pendiente":"no_requiere";_estadoConciliacion=_hasInvoice?"pendiente_bancaria":expenseData.will_have_cfdi?"pendiente_factura":"sin_factura";backendExpense={descripcion:expenseData.descripcion||expenseData.name||"Gasto sin descripci\xF3n",monto_total:expenseData.monto_total||expenseData.total_amount||0,fecha_gasto:expenseData.fecha_gasto||expenseData.date,categoria:expenseData.categoria||expenseData.category,proveedor:expenseData.proveedor,rfc:expenseData.rfc,tax_info:expenseData.tax_info,asientos_contables:expenseData.asientos_contables,workflow_status:expenseData.workflow_status||"draft",estado_factura:_estadoFactura,estado_conciliacion:_estadoConciliacion,forma_pago:expenseData.forma_pago||expenseData.payment_mode,paid_by:expenseData.paid_by||"company_account",will_have_cfdi:expenseData.will_have_cfdi!==false,movimientos_bancarios:expenseData.movimientos_bancarios,metadata:_objectSpread({factura_id:expenseData.factura_id,factura_url:_hasInvoice?expenseData.factura_url||"https://erp.tuempresa.com/facturas/".concat(expenseData.factura_id):null,movimiento_bancario:_hasInvoice?expenseData.movimiento_bancario||null:null,fecha_creacion:new Date().toISOString()},expenseData.metadata)};_context20.n=6;return fetch("/expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(backendExpense)});case 6:response=_context20.v;if(!response.ok){_context20.n=8;break}_context20.n=7;return response.json();case 7:savedExpense=_context20.v;normalizedExpense=normalizeExpense(savedExpense);setExpensesData(function(prevExpenses){var updatedExpenses=[].concat(_toConsumableArray(prevExpenses),[normalizedExpense]);localStorage.setItem("expensesData",JSON.stringify(updatedExpenses));return updatedExpenses});console.log("\u2705 Gasto guardado en backend:",normalizedExpense);return _context20.a(2,normalizedExpense);case 8:_context20.n=9;return response.json();case 9:errorData=_context20.v;throw new Error("Error del servidor: ".concat(errorData.detail||response.statusText));case 10:_context20.n=12;break;case 11:_context20.p=11;_t19=_context20.v;console.error("Error guardando gasto en backend:",_t19);_normalizedExpense=normalizeExpense(_objectSpread(_objectSpread({id:Date.now().toString(),fecha_creacion:new Date().toISOString()},expenseData),{},{estado_factura:estadoFactura,estado_conciliacion:estadoConciliacion,factura_url:hasInvoice?expenseData.factura_url||"https://erp.tuempresa.com/facturas/".concat(expenseData.factura_id):null,movimiento_bancario:hasInvoice?expenseData.movimiento_bancario||null:null}));currentExpenses=JSON.parse(localStorage.getItem("expensesData")||"[]");updatedExpenses=[].concat(_toConsumableArray(currentExpenses.map(normalizeExpense)),[_normalizedExpense]);localStorage.setItem("expensesData",JSON.stringify(updatedExpenses));setExpensesData(updatedExpenses);console.warn("\u26A0\uFE0F Gasto guardado en localStorage (fallback):",_normalizedExpense);return _context20.a(2,_normalizedExpense);case 12:return _context20.a(2)}},_callee20,null,[[1,11]])}));return function saveExpenseToDatabase(_x11){return _ref31.apply(this,arguments)}}();var handleRegenerateDummyData=function(){var _ref32=_asyncToGenerator(_regenerator().m(function _callee21(){var newDummyData,savedExpenses,_iterator2,_step2,dummyExpense,createResponse,savedExpense,normalizedData,_newDummyData,_normalizedData,_t20,_t21,_t22;return _regenerator().w(function(_context21){while(1)switch(_context21.p=_context21.n){case 0:if(!confirm("\xBFEst\xE1s seguro de que quieres limpiar todos los datos y generar nuevos datos de prueba?")){_context21.n=15;break}_context21.p=1;localStorage.removeItem("expensesData");newDummyData=generateDummyExpenses();console.log("\uD83C\uDFAF Recreando datos dummy en el backend...");savedExpenses=[];_iterator2=_createForOfIteratorHelper(newDummyData);_context21.p=2;_iterator2.s();case 3:if((_step2=_iterator2.n()).done){_context21.n=10;break}dummyExpense=_step2.value;_context21.p=4;_context21.n=5;return fetch("/expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(dummyExpense)});case 5:createResponse=_context21.v;if(!createResponse.ok){_context21.n=7;break}_context21.n=6;return createResponse.json();case 6:savedExpense=_context21.v;savedExpenses.push(savedExpense);case 7:_context21.n=9;break;case 8:_context21.p=8;_t20=_context21.v;console.error("Error creando gasto dummy:",_t20);case 9:_context21.n=3;break;case 10:_context21.n=12;break;case 11:_context21.p=11;_t21=_context21.v;_iterator2.e(_t21);case 12:_context21.p=12;_iterator2.f();return _context21.f(12);case 13:normalizedData=savedExpenses.map(normalizeExpense);localStorage.setItem("expensesData",JSON.stringify(normalizedData));setExpensesData(normalizedData);alert("\u2705 Se generaron ".concat(savedExpenses.length," gastos de prueba en el backend"));_context21.n=15;break;case 14:_context21.p=14;_t22=_context21.v;console.error("Error regenerando datos dummy:",_t22);_newDummyData=generateDummyExpenses();_normalizedData=_newDummyData.map(normalizeExpense);localStorage.setItem("expensesData",JSON.stringify(_normalizedData));setExpensesData(_normalizedData);alert("\u26A0\uFE0F Se generaron ".concat(_newDummyData.length," gastos de prueba en localStorage (fallback)"));case 15:return _context21.a(2)}},_callee21,null,[[4,8],[2,11,12,13],[1,14]])}));return function handleRegenerateDummyData(){return _ref32.apply(this,arguments)}}();var generateDummyExpenses=function generateDummyExpenses(){var proveedores=[{nombre:"Pemex",categoria:"combustible",rfc:"PEP970814KS3",tiene_rfc:true},{nombre:"Walmart",categoria:"oficina",rfc:"WAL9704132P6",tiene_rfc:true},{nombre:"Restaurante La Europea",categoria:"alimentos",rfc:null,tiene_rfc:false},{nombre:"Home Depot M\xE9xico",categoria:"oficina",rfc:"HDM050101RK3",tiene_rfc:true},{nombre:"Uber",categoria:"transporte",rfc:null,tiene_rfc:false},{nombre:"Microsoft M\xE9xico",categoria:"tecnologia",rfc:"MIC030201RG7",tiene_rfc:true},{nombre:"Hotel City Express",categoria:"hospedaje",rfc:"HCE060301DH8",tiene_rfc:true},{nombre:"Farmacias del Ahorro",categoria:"salud",rfc:"FDA970503JH1",tiene_rfc:true},{nombre:"Taxi Local",categoria:"transporte",rfc:null,tiene_rfc:false},{nombre:"Starbucks",categoria:"alimentos",rfc:"STA950415KN2",tiene_rfc:true}];var dummyExpenses=[];var today=new Date;var _loop=function _loop(){var proveedor=proveedores[Math.floor(Math.random()*proveedores.length)];var fechaGasto=new Date(today);fechaGasto.setDate(today.getDate()-Math.floor(Math.random()*60));var monto=Math.floor(Math.random()*5000)+100;var willHaveCfdi=proveedor.tiene_rfc&&(monto>500||Math.random()>0.3);var estadoFactura="no_requiere";if(willHaveCfdi){estadoFactura=Math.random()>0.4?"pendiente":"facturado"}var facturaId=estadoFactura==="facturado"?"FAC-".concat(Math.floor(Math.random()*10000)):null;var facturaUrl=facturaId?"https://erp.tuempresa.com/facturas/".concat(facturaId):null;var movimientoBancario=null;var movimientosBancarios=[];var estadoConciliacion="sin_factura";var fechaConciliacionBancaria=null;var taxInfo=function(){if(!willHaveCfdi)return null;var ivaAmount=round2(monto*0.16);var subtotalCalc=round2(monto-ivaAmount);return{subtotal:subtotalCalc,total:monto,currency:"MXN",taxes:[{type:"IVA",code:"002",kind:"traslado",rate:0.16,amount:ivaAmount}],iva_amount:ivaAmount,other_taxes:0}}();if(estadoFactura==="facturado"){if(Math.random()>0.55){var sampleMovement=SAMPLE_BANK_MOVEMENTS[Math.floor(Math.random()*SAMPLE_BANK_MOVEMENTS.length)];var movement=_objectSpread({},sampleMovement);movimientoBancario=movement;movimientosBancarios=[movement];estadoConciliacion="conciliado_banco";fechaConciliacionBancaria=new Date().toISOString()}else{estadoConciliacion="pendiente_bancaria"}}else if(estadoFactura==="pendiente"){estadoConciliacion=facturaId?"pendiente_bancaria":"pendiente_factura"}var baseExpense={id:"exp_".concat(Date.now(),"_").concat(i),descripcion:"Gasto en ".concat(proveedor.nombre," - ").concat(getCategoryLabel(proveedor.categoria)),monto_total:monto,fecha_gasto:fechaGasto.toISOString().split("T")[0],"proveedor.nombre":proveedor.nombre,categoria:proveedor.categoria,forma_pago:Math.random()>0.5?"tarjeta_empresa":"efectivo",will_have_cfdi:willHaveCfdi,paid_by:Math.random()>0.6?"company_account":"own_account",rfc:proveedor.rfc,estado_factura:estadoFactura,estado_conciliacion:estadoConciliacion,fecha_creacion:new Date().toISOString(),tax_info:taxInfo,factura_id:facturaId,factura_url:facturaUrl,movimiento_bancario:movimientoBancario,movimientos_bancarios:movimientosBancarios,fecha_conciliacion_bancaria:fechaConciliacionBancaria,completitud:calculateCompleteness(willHaveCfdi,estadoFactura,proveedor.rfc)};var expense=_objectSpread(_objectSpread({},baseExpense),{},{asientos_contables:generateAccountingEntries(_objectSpread({},baseExpense))});dummyExpenses.push(expense)};for(var i=0;i<15;i++){_loop()}return dummyExpenses};var getCategoryLabel=function getCategoryLabel(categoryValue){var category=CATEGORIAS_DISPONIBLES.find(function(cat){return cat.value===categoryValue});return category?category.label.substring(2):"Otros"};var EXPENSE_ACCOUNT_MAP={combustible:{cuenta:"6140",nombre:"Combustibles y lubricantes"},alimentos:{cuenta:"6150",nombre:"Vi\xE1ticos y viajes"},transporte:{cuenta:"6130",nombre:"Servicios b\xE1sicos (transporte)"},hospedaje:{cuenta:"6150",nombre:"Vi\xE1ticos y viajes"},oficina:{cuenta:"6180",nombre:"Papeler\xEDa y miscel\xE1neos"},tecnologia:{cuenta:"6160",nombre:"Publicidad y marketing"},marketing:{cuenta:"6160",nombre:"Publicidad y marketing"},capacitacion:{cuenta:"6150",nombre:"Vi\xE1ticos y viajes"},salud:{cuenta:"6190",nombre:"Gastos no deducibles"},otros:{cuenta:"6190",nombre:"Gastos no deducibles"}};var TAX_ACCOUNT_MAP={IVA:{traslado:{cuenta:"1190",nombre:"IVA acreditable pendiente",tipo:"iva_acreditable"},retencion:{cuenta:"2130",nombre:"IVA retenido por pagar",tipo:"pasivo"}},ISR:{retencion:{cuenta:"2110",nombre:"ISR retenido por pagar",tipo:"pasivo"}},IEPS:{traslado:{cuenta:"1195",nombre:"IEPS acreditable pagado",tipo:"impuesto_acreditable"}},OTRO:{traslado:{cuenta:"1180",nombre:"Impuestos acreditables diversos",tipo:"impuesto"},retencion:{cuenta:"2190",nombre:"Retenciones diversas por pagar",tipo:"pasivo"}}};var PAYMENT_ACCOUNT_MAP={company_account:{cuenta:"1110",nombre:"Bancos",tipo:"activo"},own_account:{cuenta:"2110",nombre:"Acreedores diversos",tipo:"pasivo"}};var round2=function round2(value){return Math.round((Number(value)||0)*100)/100};var toAmount=function toAmount(value){return round2(value).toFixed(2)};var resolveTaxAccount=function resolveTaxAccount(tax){var taxType=(tax.type||"OTRO").toUpperCase();var mapping=TAX_ACCOUNT_MAP[taxType]||TAX_ACCOUNT_MAP.OTRO;return(tax.kind==="retencion"?mapping.retencion:mapping.traslado)||(tax.kind==="retencion"?TAX_ACCOUNT_MAP.OTRO.retencion:TAX_ACCOUNT_MAP.OTRO.traslado)};var generateAccountingEntries=function generateAccountingEntries(expense){var categoria=expense.categoria||"otros";var cuentaGasto=EXPENSE_ACCOUNT_MAP[categoria]||EXPENSE_ACCOUNT_MAP.otros;var total=round2(expense.monto_total||expense.total||0);var taxInfo=expense.tax_info||expense.tax_breakdown||null;var taxes=Array.isArray(taxInfo===null||taxInfo===void 0?void 0:taxInfo.taxes)?taxInfo.taxes:[];var traslados=taxes.filter(function(tax){return tax.kind==="traslado"});var retenciones=taxes.filter(function(tax){return tax.kind==="retencion"});var trasladosSum=round2(traslados.reduce(function(sum,tax){return sum+(tax.amount||0)},0));var retencionesSum=round2(retenciones.reduce(function(sum,tax){return sum+(tax.amount||0)},0));var subtotal=round2(taxInfo===null||taxInfo===void 0?void 0:taxInfo.subtotal);if(!(subtotal>0)){subtotal=round2(total+retencionesSum-trasladosSum)}if(subtotal<0)subtotal=0;var willHaveCfdi=!!expense.will_have_cfdi;var estadoFactura=expense.estado_factura||(willHaveCfdi?"pendiente":"no_requiere");var paidBy=expense.paid_by||"company_account";var movimientos=[];var pushEntry=function pushEntry(cuenta,nombre,debe,haber,tipo){movimientos.push({cuenta:cuenta,nombre_cuenta:nombre,debe:toAmount(debe),haber:toAmount(haber),tipo:tipo})};if(subtotal>0){pushEntry(cuentaGasto.cuenta,cuentaGasto.nombre,subtotal,0,"gasto")}traslados.forEach(function(tax){var config=resolveTaxAccount(tax);if(!config)return;var amount=round2(tax.amount||0);if(amount<=0)return;pushEntry(config.cuenta,config.nombre,amount,0,config.tipo)});var totalDebits=round2(movimientos.reduce(function(sum,mov){return sum+parseFloat(mov.debe)},0));if(totalDebits<=0&&total>0){totalDebits=total;pushEntry(cuentaGasto.cuenta,cuentaGasto.nombre,total,0,"gasto")}var paymentAccount=PAYMENT_ACCOUNT_MAP[paidBy]||PAYMENT_ACCOUNT_MAP.company_account;var providerAccount={cuenta:"2100",nombre:"Proveedores",tipo:"pasivo"};if(estadoFactura==="facturado"){var providerCredit=round2(totalDebits-retencionesSum);if(providerCredit>0){pushEntry(providerAccount.cuenta,providerAccount.nombre,0,providerCredit,providerAccount.tipo)}retenciones.forEach(function(tax){var config=resolveTaxAccount(tax);if(!config)return;var amount=round2(tax.amount||0);if(amount<=0)return;pushEntry(config.cuenta,config.nombre,0,amount,config.tipo||"pasivo")})}else{var paymentCredit=round2(totalDebits-retencionesSum);if(paymentCredit>0){pushEntry(paymentAccount.cuenta,paymentAccount.nombre,0,paymentCredit,paymentAccount.tipo||"pasivo")}retenciones.forEach(function(tax){var config=resolveTaxAccount(tax);if(!config)return;var amount=round2(tax.amount||0);if(amount<=0)return;pushEntry(config.cuenta,config.nombre,0,amount,config.tipo||"pasivo")})}var totalDebe=round2(movimientos.reduce(function(sum,mov){return sum+parseFloat(mov.debe)},0));var totalHaber=round2(movimientos.reduce(function(sum,mov){return sum+parseFloat(mov.haber)},0));var diff=round2(totalDebe-totalHaber);if(Math.abs(diff)>=0.01&&movimientos.length>0){var adjustIndex=movimientos.findIndex(function(mov){return parseFloat(mov.haber)>0})!==-1?movimientos.findIndex(function(mov){return parseFloat(mov.haber)>0}):movimientos.findIndex(function(mov){return parseFloat(mov.debe)>0});if(adjustIndex!==-1){var target=movimientos[adjustIndex];if(diff>0){target.haber=toAmount(parseFloat(target.haber)+diff)}else{target.debe=toAmount(parseFloat(target.debe)+diff*-1)}}totalDebe=round2(movimientos.reduce(function(sum,mov){return sum+parseFloat(mov.debe)},0));totalHaber=round2(movimientos.reduce(function(sum,mov){return sum+parseFloat(mov.haber)},0));diff=round2(totalDebe-totalHaber)}return{fecha_asiento:new Date().toISOString().split("T")[0],numero_poliza:"POL-".concat(Math.floor(Math.random()*10000)),tipo_poliza:willHaveCfdi?"Egresos con IVA":"Egresos sin factura",concepto:"Registro de gasto - ".concat(cuentaGasto.nombre),movimientos:movimientos,total_debe:toAmount(totalDebe),total_haber:toAmount(totalHaber),balanceado:Math.abs(diff)<0.01}};var calculateCompleteness=function calculateCompleteness(willHaveCfdi,estadoFactura,rfc){var criterios={datos_basicos:true,facturacion_requerida:willHaveCfdi,factura_recibida:estadoFactura==="facturado",rfc_proveedor:!!rfc,asientos_generados:true,conciliado:estadoFactura==="facturado"||!willHaveCfdi};var score=0;var total=0;total+=2;if(criterios.datos_basicos)score+=2;total+=2;if(criterios.asientos_generados)score+=2;if(criterios.facturacion_requerida){total+=3;if(criterios.factura_recibida)score+=3;total+=1;if(criterios.rfc_proveedor)score+=1}total+=2;if(criterios.conciliado)score+=2;var porcentaje=Math.round(score/total*100);return{porcentaje:porcentaje,criterios:criterios,estado:porcentaje===100?"completo":porcentaje>=70?"parcial":"incompleto",detalles:{score:score,total:total,faltan:total-score}}};var progress=calculateProgress();var missingRequiredFields=["descripcion","monto_total","fecha_gasto","proveedor.nombre","forma_pago","will_have_cfdi","paid_by"].filter(function(field){var value=getFieldValue(field);return!value});return React.createElement("div",{className:"max-w-6xl mx-auto p-6 space-y-6"},React.createElement("div",{className:"text-center space-y-4"},React.createElement("h1",{className:"text-3xl font-bold text-gray-900"},"Registro de Gastos con Voz"),React.createElement("p",{className:"text-lg text-gray-600"},"Dicta la informaci\xF3n de tu gasto y revisa los campos detectados"),React.createElement("div",{className:"flex justify-center gap-3 flex-wrap"},React.createElement("button",{onClick:function onClick(){return setShowExpensesDashboard(true)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},React.createElement("i",{className:"fas fa-chart-bar mr-2"}),"Dashboard de Gastos"),React.createElement("button",{onClick:function onClick(){return setShowPendingInvoices(true)},className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm"},React.createElement("i",{className:"fas fa-file-invoice mr-2"}),"Facturas Pendientes"),React.createElement("div",{className:"relative"},React.createElement("button",{onClick:function onClick(){return setMoreActionsOpen(function(open){return!open})},"aria-haspopup":"true","aria-expanded":moreActionsOpen,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors text-sm flex items-center"},React.createElement("i",{className:"fas fa-ellipsis-h mr-2"}),"M\xE1s opciones"),moreActionsOpen&&React.createElement("div",{className:"absolute right-0 mt-2 w-56 bg-white shadow-lg rounded-lg border border-gray-200 z-10"},React.createElement("ul",{className:"py-2 text-sm text-gray-700"},React.createElement("li",null,React.createElement("button",{onClick:function onClick(){setShowInvoiceUpload(true);setMoreActionsOpen(false)},className:"w-full text-left px-4 py-2 hover:bg-gray-100"},React.createElement("i",{className:"fas fa-upload mr-2 text-green-600"}),"Cargar Facturas")),React.createElement("li",null,React.createElement("button",{onClick:function onClick(){setShowReconciliation(true);setMoreActionsOpen(false)},className:"w-full text-left px-4 py-2 hover:bg-gray-100"},React.createElement("i",{className:"fas fa-balance-scale mr-2 text-purple-600"}),"Conciliar Gastos")),React.createElement("li",null,React.createElement("button",{onClick:function onClick(){setShowBankReconciliation(true);setMoreActionsOpen(false)},className:"w-full text-left px-4 py-2 hover:bg-gray-100"},React.createElement("i",{className:"fas fa-university mr-2 text-teal-600"}),"Conciliaci\xF3n Bancaria")),React.createElement("li",null,React.createElement("button",{onClick:function onClick(){setShowCompletenessView(true);setMoreActionsOpen(false)},className:"w-full text-left px-4 py-2 hover:bg-gray-100"},React.createElement("i",{className:"fas fa-clipboard-check mr-2 text-indigo-600"}),"Vista Contable")),React.createElement("li",null,React.createElement("button",{onClick:function onClick(){setShowConversationalAssistant(true);setMoreActionsOpen(false)},className:"w-full text-left px-4 py-2 hover:bg-gray-100"},React.createElement("i",{className:"fas fa-robot mr-2 text-pink-600"}),"Asistente IA"))))))),React.createElement("div",{className:"bg-white rounded-lg shadow-md p-8"},React.createElement("div",{className:"text-center space-y-6"},React.createElement("h3",{className:"text-xl font-semibold text-gray-800"},"\xBFC\xF3mo quieres registrar el gasto?"),React.createElement("div",{className:"flex justify-center gap-4"},React.createElement("button",{onClick:function onClick(){return setInputMode("voice")},className:"flex flex-col items-center p-6 rounded-lg border-2 transition-all ".concat(inputMode==="voice"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-600 hover:border-blue-300")},React.createElement("i",{className:"fas fa-microphone text-3xl mb-2"}),React.createElement("span",{className:"font-medium"},"Voz"),React.createElement("span",{className:"text-xs text-center"},"Dictado por voz")),React.createElement("button",{onClick:function onClick(){return setInputMode("ocr")},className:"flex flex-col items-center p-6 rounded-lg border-2 transition-all ".concat(inputMode==="ocr"?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-600 hover:border-green-300")},React.createElement("i",{className:"fas fa-camera text-3xl mb-2"}),React.createElement("span",{className:"font-medium"},"Subir Ticket"),React.createElement("span",{className:"text-xs text-center"},"OCR autom\xE1tico")),React.createElement("button",{onClick:function onClick(){return setInputMode("text")},className:"flex flex-col items-center p-6 rounded-lg border-2 transition-all ".concat(inputMode==="text"?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-300 bg-white text-gray-600 hover:border-purple-300")},React.createElement("i",{className:"fas fa-keyboard text-3xl mb-2"}),React.createElement("span",{className:"font-medium"},"Texto"),React.createElement("span",{className:"text-xs text-center"},"Escribir directo"))),React.createElement("div",{className:"mt-8"},inputMode==="voice"&&React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"relative"},React.createElement("button",{onClick:handleToggleRecording,className:"w-20 h-20 rounded-full flex items-center justify-center text-white text-2xl transition-all duration-200 ".concat(isRecording?"bg-red-500 recording-ring":"bg-blue-500 hover:bg-blue-600")},React.createElement("i",{className:isRecording?"fas fa-stop":"fas fa-microphone"})),isRecording&&React.createElement("div",{className:"absolute inset-0 border-4 border-red-300 rounded-full animate-ping"})),React.createElement("div",{className:"space-y-2"},React.createElement("p",{className:"text-lg font-medium ".concat(isRecording?"text-red-600":"text-gray-700")},isRecording?"\uD83C\uDFA4 Escuchando...":"\uD83C\uDFA4 Haz clic para grabar"),React.createElement("p",{className:"text-sm text-gray-500"},isRecording?"Describe tu gasto de manera natural":"Ejemplo: \"Gasto de gasolina de 500 pesos en Pemex\""))),inputMode==="ocr"&&React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"border-2 border-dashed border-green-300 rounded-lg p-8 bg-green-50"},React.createElement("input",{type:"file",id:"ocr-file-upload",accept:"image/*,.pdf,.heic,.heif",className:"hidden",onChange:function onChange(e){var file=e.target.files[0];if(file)handleOcrUpload(file)}}),React.createElement("label",{htmlFor:"ocr-file-upload",className:"cursor-pointer block text-center"},isUploading?React.createElement("div",null,React.createElement("i",{className:"fas fa-spinner fa-spin text-4xl text-green-500 mb-4"}),React.createElement("p",{className:"text-lg font-medium text-green-700"},"Procesando con OCR..."),React.createElement("p",{className:"text-sm text-green-600"},"Extrayendo campos del documento")):React.createElement("div",null,React.createElement("i",{className:"fas fa-cloud-upload-alt text-4xl text-green-500 mb-4"}),React.createElement("p",{className:"text-lg font-medium text-green-700"},"Subir Ticket o Factura"),React.createElement("p",{className:"text-sm text-green-600"},"Soporta JPG, PNG, HEIC, PDF hasta 10MB"),React.createElement("p",{className:"text-xs text-gray-500 mt-2"},"OCR detectar\xE1 autom\xE1ticamente proveedor, RFC, fecha y montos")))),ocrResult&&React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"bg-green-100 border border-green-300 rounded-lg p-4"},React.createElement("div",{className:"flex items-center gap-2 mb-2"},React.createElement("i",{className:"fas fa-check-circle text-green-600"}),React.createElement("span",{className:"font-medium text-green-800"},"OCR Completado"),React.createElement("span",{className:"text-sm text-green-600"},"Confianza: ",Math.round((ocrResult.ocr_confidence||0)*100),"%")),React.createElement("p",{className:"text-sm text-green-700"},ocrResult.message)),ocrResult.fields&&React.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4"},React.createElement("div",{className:"flex items-center gap-2 mb-3"},React.createElement("i",{className:"fas fa-brain text-blue-600"}),React.createElement("span",{className:"font-medium text-blue-800"},"Inteligencia Aplicada")),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},ocrResult.fields.categoria&&React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-tag text-blue-500"}),React.createElement("span",{className:"text-gray-600"},"Categor\xEDa:"),React.createElement("span",{className:"font-medium text-blue-700"},ocrResult.fields.categoria),ocrResult.fields.confianza_categoria&&React.createElement("span",{className:"text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded"},Math.round(ocrResult.fields.confianza_categoria*100),"%")),ocrResult.fields.forma_pago&&React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-credit-card text-blue-500"}),React.createElement("span",{className:"text-gray-600"},"Forma de pago:"),React.createElement("span",{className:"font-medium text-blue-700"},ocrResult.fields.forma_pago)),ocrResult.fields.validacion_rfc&&React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas ".concat(ocrResult.fields.validacion_rfc.valido?"fa-check-circle text-green-500":"fa-exclamation-circle text-yellow-500")}),React.createElement("span",{className:"text-gray-600"},"RFC:"),React.createElement("span",{className:"font-medium ".concat(ocrResult.fields.validacion_rfc.valido?"text-green-700":"text-yellow-700")},ocrResult.fields.validacion_rfc.mensaje)),ocrResult.fields.iva_desglosado&&React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-calculator text-blue-500"}),React.createElement("span",{className:"text-gray-600"},"IVA:"),React.createElement("span",{className:"font-medium text-blue-700"},"$",ocrResult.fields.iva_desglosado.subtotal," + $",ocrResult.fields.iva_desglosado.iva," (",ocrResult.fields.iva_desglosado.tasa_iva,"%)"))),ocrResult.fields.descripcion_inteligente&&React.createElement("div",{className:"mt-3 pt-3 border-t border-blue-200"},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("i",{className:"fas fa-lightbulb text-blue-500 mt-1"}),React.createElement("div",null,React.createElement("span",{className:"text-gray-600 text-sm"},"Descripci\xF3n inteligente:"),React.createElement("p",{className:"font-medium text-blue-700"},ocrResult.fields.descripcion_inteligente))))))),inputMode==="text"&&React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"bg-purple-50 rounded-lg p-6"},React.createElement("textarea",{placeholder:"Escribe la informaci\xF3n del gasto...\nEjemplo: 'Compra de gasolina por 500 pesos en Pemex, pagado con tarjeta de empresa'",className:"w-full h-32 p-4 border border-purple-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-purple-500",onChange:function onChange(e){if(e.target.value.trim()){handleTextInput(e.target.value)}}}),React.createElement("div",{className:"mt-3 text-center"},React.createElement("button",{onClick:function onClick(){var textarea=document.querySelector("textarea");if(textarea.value.trim()){handleTextInput(textarea.value)}},className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"},React.createElement("i",{className:"fas fa-magic mr-2"}),"Procesar Texto"))),React.createElement("div",{className:"text-sm text-gray-600 bg-gray-50 rounded-lg p-3"},React.createElement("p",{className:"font-medium mb-1"},"\uD83D\uDCA1 Consejos:"),React.createElement("ul",{className:"text-xs space-y-1"},React.createElement("li",null,"\u2022 Incluye el monto: \"500 pesos\", \"$1,200\""),React.createElement("li",null,"\u2022 Menciona el proveedor: \"Pemex\", \"Oxxo\", \"Liverpool\""),React.createElement("li",null,"\u2022 Indica el m\xE9todo de pago: \"tarjeta empresa\", \"efectivo\""))))))),React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6"},React.createElement("div",{className:"lg:col-span-1 space-y-6"},React.createElement("div",{className:"bg-white rounded-lg shadow-md p-4"},React.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-microphone text-gray-500"}),"Transcripci\xF3n en Vivo"),React.createElement("div",{className:"h-32 overflow-y-auto bg-gray-50 p-3 rounded border"},transcript?React.createElement("p",{className:"text-gray-700"},transcript):React.createElement("p",{className:"text-gray-400 text-center"},isRecording?"Comienza a hablar...":"Esperando transcripci\xF3n..."))),currentSummary&&React.createElement("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-blue-400"},React.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"Resumen Detectado"),React.createElement("p",{className:"text-gray-700 mb-3"},currentSummary),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(summaryConfidence>=0.8?"bg-green-100 text-green-800":summaryConfidence>=0.5?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800")},summaryConfidence>=0.8?"Alta confianza":summaryConfidence>=0.5?"Confianza media":"Baja confianza"),React.createElement("span",{className:"text-xs text-gray-500"},Math.round(summaryConfidence*100),"%")))),React.createElement("div",{className:"lg:col-span-2 space-y-6"},React.createElement("div",{className:"bg-white rounded-lg shadow-md p-4"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("h3",{className:"text-lg font-medium text-gray-900"},"Progreso de Completitud"),React.createElement("div",{className:"text-right"},React.createElement("div",{className:"text-2xl font-bold text-gray-900"},progress,"%"),React.createElement("div",{className:"text-sm text-gray-500"},Object.keys(formData).filter(function(k){return!k.startsWith("_")}).length,"/",Object.keys(EXPENSE_FIELDS).length," campos"))),React.createElement("div",{className:"mb-4"},React.createElement("div",{className:"w-full h-3 rounded-full ".concat(progress>=80?"bg-green-50":progress>=50?"bg-yellow-50":"bg-red-50")},React.createElement("div",{className:"h-3 rounded-full transition-all duration-500 ".concat(progress>=80?"bg-green-500":progress>=50?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(progress,"%")}}))),React.createElement("div",{className:"text-center text-sm text-gray-600"},progress>=80?"Listo para enviar":progress>=50?"En progreso":"Necesita m\xE1s informaci\xF3n")),React.createElement("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6"},React.createElement("div",{className:"bg-white rounded-lg shadow-md p-4"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2"},React.createElement("i",{className:"fas fa-check-circle text-green-500"}),"Campos Capturados"),React.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-2 py-1"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-database text-blue-600 text-xs"}),React.createElement("span",{className:"text-xs text-blue-700 font-medium"},expensesData.length," gastos registrados"),React.createElement("button",{onClick:handleRegenerateDummyData,className:"text-xs text-blue-600 hover:text-blue-800 ml-2",title:"Regenerar datos de prueba"},"\uD83D\uDD04")))),React.createElement("div",{className:"space-y-3"},Object.entries(EXPENSE_FIELDS).map(function(_ref33){var _ref34=_slicedToArray(_ref33,2),fieldKey=_ref34[0],fieldConfig=_ref34[1];var value=getFieldValue(fieldKey);var confidence=getFieldConfidence(fieldKey);if(!value)return null;var displayValue=value;if(fieldKey==="monto_total"&&typeof value==="number"){displayValue="$".concat(value.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}))}else if(fieldKey==="fecha_gasto"&&value){var date=new Date(value);displayValue=date.toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric"})}else if(fieldKey==="will_have_cfdi"){displayValue=value?"S\xED, habr\xE1 factura (CFDI)":"No, sin factura"}else if(fieldKey==="paid_by"){displayValue=value==="company_account"?"Empresa (tarjeta corporativa)":"Empleado (reembolso)"}else if(_typeof(value)==="object"){displayValue=JSON.stringify(value)}else{displayValue=String(value)}return React.createElement("div",{key:fieldKey,className:"border rounded-lg p-3 bg-green-50 border-green-200"},React.createElement("div",{className:"flex items-start justify-between"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-2 mb-1"},React.createElement("span",{className:"text-sm font-medium text-gray-900"},fieldConfig.name),fieldConfig.required&&React.createElement("span",{className:"text-red-500 text-xs"},"*"),formData._ocrIntakeId&&React.createElement("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},"OCR")),React.createElement("div",{className:"text-base font-medium text-green-700"},displayValue),confidence>0&&React.createElement("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1"},React.createElement("div",{className:"w-2 h-2 rounded-full ".concat(confidence>=0.8?"bg-green-500":confidence>=0.6?"bg-yellow-500":"bg-red-500")}),Math.round(confidence*100),"% confianza")),React.createElement("button",{onClick:function onClick(){var currentValue=value;if(fieldKey==="will_have_cfdi"){currentValue=value?"true":"false"}else if(fieldKey==="paid_by"){currentValue=value}var newValue=prompt("Editar ".concat(fieldConfig.name,":"),String(currentValue));if(newValue!==null&&newValue!==String(currentValue)){var processedValue=newValue;if(fieldKey==="monto_total"){processedValue=parseFloat(newValue.replace(/[$,]/g,""))||0}else if(fieldKey==="will_have_cfdi"){processedValue=newValue.toLowerCase()==="true"}handleFieldChange(fieldKey,processedValue)}},className:"px-2 py-1 text-xs text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-colors"},React.createElement("i",{className:"fas fa-edit mr-1"}),"Editar")))}),Object.keys(formData).filter(function(k){return!k.startsWith("_")}).length===0&&React.createElement("div",{className:"text-center py-8"},React.createElement("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center"},React.createElement("i",{className:"fas fa-microphone text-gray-400 text-2xl"})),React.createElement("p",{className:"text-gray-500 text-sm"},"A\xFAn no se han capturado campos del gasto"),React.createElement("p",{className:"text-gray-400 text-xs mt-1"},"Usa el micr\xF3fono para dictar la informaci\xF3n")))),React.createElement("div",{className:"bg-white rounded-lg shadow-md p-4"},React.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-list text-orange-500"}),"Campos Pendientes"),React.createElement("div",{className:"space-y-4"},Object.entries(EXPENSE_FIELDS).map(function(_ref35){var _fieldConfig$options;var _ref36=_slicedToArray(_ref35,2),fieldKey=_ref36[0],fieldConfig=_ref36[1];var value=getFieldValue(fieldKey);if(value)return null;return React.createElement("div",{key:fieldKey,className:"border rounded-lg p-3 ".concat(fieldConfig.required?"border-orange-200 bg-orange-50":"border-gray-200 bg-gray-50")},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},fieldConfig.name,fieldConfig.required&&React.createElement("span",{className:"text-red-500 ml-1"},"*")),fieldConfig.type==="select"?React.createElement("div",null,React.createElement("select",{value:value||"",onChange:function onChange(e){return handleFieldChange(fieldKey,e.target.value)},className:"w-full p-2 border border-gray-300 rounded-md text-sm"},React.createElement("option",{value:""},"Selecciona una opci\xF3n"),(_fieldConfig$options=fieldConfig.options)===null||_fieldConfig$options===void 0?void 0:_fieldConfig$options.map(function(option){return React.createElement("option",{key:option.value,value:option.value},option.label)})),fieldKey==="categoria"&&React.createElement("div",{className:"mt-2 space-y-2"},isPredictingCategory&&React.createElement("div",{className:"flex items-center text-xs text-blue-600"},React.createElement("i",{className:"fas fa-robot fa-spin mr-2"}),"Prediciendo categor\xEDa con IA..."),categoryPrediction&&!value&&categoryPrediction.confianza<0.8&&React.createElement("div",{className:"p-2 bg-blue-50 rounded-md border border-blue-200"},React.createElement("div",{className:"text-xs font-medium text-blue-800 mb-1"},"\uD83E\uDD16 IA sugiere: ",categoryPrediction.categoria_sugerida,React.createElement("span",{className:"ml-1 text-blue-600"},"(",Math.round(categoryPrediction.confianza*100),"% confianza)")),React.createElement("div",{className:"text-xs text-blue-700 mb-2"},categoryPrediction.razonamiento),React.createElement("button",{onClick:function onClick(){handleFieldChange("categoria",categoryPrediction.categoria_sugerida);setCategoryPrediction(null)},className:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 mr-2"},"\u2705 Aplicar"),React.createElement("button",{onClick:function onClick(){return setCategoryPrediction(null)},className:"px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500"},"\u274C Rechazar"),categoryPrediction.alternativas&&categoryPrediction.alternativas.length>0&&React.createElement("div",{className:"mt-2"},React.createElement("div",{className:"text-xs text-blue-700 mb-1"},"Alternativas:"),React.createElement("div",{className:"flex flex-wrap gap-1"},categoryPrediction.alternativas.map(function(alt,idx){return React.createElement("button",{key:idx,onClick:function onClick(){handleFieldChange("categoria",alt.categoria);setCategoryPrediction(null)},className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded hover:bg-blue-200",title:alt.razon},alt.categoria," (",Math.round(alt.confianza*100),"%)")})))),value&&categoryPrediction&&React.createElement("div",{className:"text-xs text-green-600"},"\u2705 Categor\xEDa aplicada por IA: ",value,"(",categoryPrediction.metodo_prediccion==="llm"?"GPT":"Reglas",")"),!categoryPrediction&&!isPredictingCategory&&React.createElement("div",{className:"text-xs text-gray-500"},"\uD83D\uDCA1 Completa la descripci\xF3n para sugerencia autom\xE1tica"))):fieldConfig.type==="number"?React.createElement("input",{type:"number",value:value||"",onChange:function onChange(e){return handleFieldChange(fieldKey,parseFloat(e.target.value)||0)},placeholder:fieldConfig.placeholder,className:"w-full p-2 border border-gray-300 rounded-md text-sm",step:"0.01",min:"0"}):fieldConfig.type==="date"?React.createElement("input",{type:"date",value:value||"",onChange:function onChange(e){return handleFieldChange(fieldKey,e.target.value)},className:"w-full p-2 border border-gray-300 rounded-md text-sm",max:new Date().toISOString().split("T")[0]}):fieldConfig.type==="textarea"?React.createElement("textarea",{value:value||"",onChange:function onChange(e){return handleFieldChange(fieldKey,e.target.value)},placeholder:fieldConfig.placeholder,className:"w-full p-2 border border-gray-300 rounded-md text-sm",rows:"3"}):React.createElement("input",{type:"text",value:value||"",onChange:function onChange(e){return handleFieldChange(fieldKey,e.target.value)},placeholder:fieldConfig.placeholder,className:"w-full p-2 border border-gray-300 rounded-md text-sm"}),fieldConfig.help&&React.createElement("p",{className:"text-xs text-gray-500 mt-1"},fieldConfig.help))})))))),React.createElement("div",{className:"bg-white border border-gray-200 rounded-lg shadow-md p-6"},React.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-paperclip text-blue-500"}),"Adjuntar Comprobantes"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},React.createElement("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-400 transition-colors"},React.createElement("input",{type:"file",id:"ticket-upload",accept:"image/*,.pdf,.heic,.heif",className:"hidden",onChange:function onChange(e){var file=e.target.files[0];if(file){handleFieldChange("ticket_file",file.name)}}}),React.createElement("label",{htmlFor:"ticket-upload",className:"cursor-pointer block"},React.createElement("i",{className:"fas fa-camera text-3xl text-gray-400 mb-2"}),React.createElement("p",{className:"text-sm font-medium text-gray-700"},"Foto del Ticket"),React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"JPG, PNG, HEIC, PDF hasta 10MB")),getFieldValue("ticket_file")&&React.createElement("div",{className:"mt-2 text-xs text-green-600"},React.createElement("i",{className:"fas fa-check mr-1"}),getFieldValue("ticket_file"))),React.createElement("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-400 transition-colors"},React.createElement("input",{type:"file",id:"xml-upload",accept:".xml",className:"hidden",onChange:function onChange(e){var file=e.target.files[0];if(file){handleXmlUpload(file)}}}),React.createElement("label",{htmlFor:"xml-upload",className:"cursor-pointer block"},React.createElement("i",{className:"fas fa-file-code text-3xl text-gray-400 mb-2"}),React.createElement("p",{className:"text-sm font-medium text-gray-700"},"XML Factura"),React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Archivo XML CFDI")),getFieldValue("xml_file")&&React.createElement("div",{className:"mt-2 text-xs text-green-600"},React.createElement("i",{className:"fas fa-check mr-1"}),getFieldValue("xml_file"))),React.createElement("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-red-400 transition-colors"},React.createElement("input",{type:"file",id:"pdf-upload",accept:".pdf",className:"hidden",onChange:function onChange(e){var file=e.target.files[0];if(file){handleFieldChange("pdf_file",file.name)}}}),React.createElement("label",{htmlFor:"pdf-upload",className:"cursor-pointer block"},React.createElement("i",{className:"fas fa-file-pdf text-3xl text-gray-400 mb-2"}),React.createElement("p",{className:"text-sm font-medium text-gray-700"},"PDF Factura"),React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Representaci\xF3n impresa")),getFieldValue("pdf_file")&&React.createElement("div",{className:"mt-2 text-xs text-green-600"},React.createElement("i",{className:"fas fa-check mr-1"}),getFieldValue("pdf_file")))),React.createElement("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3"},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("i",{className:"fas fa-info-circle text-blue-500 mt-0.5"}),React.createElement("div",{className:"text-sm text-blue-700"},React.createElement("p",{className:"font-medium"},"Tipos de comprobantes:"),React.createElement("ul",{className:"mt-1 text-xs space-y-1"},React.createElement("li",null,"\u2022 ",React.createElement("strong",null,"Ticket:")," Foto del comprobante o nota de venta"),React.createElement("li",null,"\u2022 ",React.createElement("strong",null,"XML:")," Archivo CFDI para gastos con factura"),React.createElement("li",null,"\u2022 ",React.createElement("strong",null,"PDF:")," Representaci\xF3n impresa de la factura"))))),invoiceParsing.status==="loading"&&React.createElement("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm text-yellow-800 flex items-center gap-2"},React.createElement("i",{className:"fas fa-spinner fa-spin"}),"Analizando CFDI ",invoiceParsing.filename||"","..."),invoiceParsing.status==="error"&&React.createElement("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700 flex items-center gap-2"},React.createElement("i",{className:"fas fa-triangle-exclamation"}),invoiceParsing.message||"No se pudo interpretar el CFDI. Intenta nuevamente."),formData.tax_info&&React.createElement("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-4 text-sm text-green-800"},React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("h4",{className:"font-medium"},"IVA e impuestos detectados del CFDI"),formData.tax_info.uuid&&React.createElement("span",{className:"text-xs text-green-600"},"UUID: ",formData.tax_info.uuid)),React.createElement("div",{className:"grid grid-cols-2 gap-2 text-xs text-green-700"},React.createElement("span",null,"Subtotal: ",React.createElement("strong",null,"$",(formData.tax_info.subtotal||0).toLocaleString("es-MX",{minimumFractionDigits:2}))),React.createElement("span",null,"Total: ",React.createElement("strong",null,"$",(formData.tax_info.total||formData.monto_total||0).toLocaleString("es-MX",{minimumFractionDigits:2}))),React.createElement("span",null,"IVA acreditable: ",React.createElement("strong",null,"$",(formData.tax_info.iva_amount||0).toLocaleString("es-MX",{minimumFractionDigits:2}))),React.createElement("span",null,"Otros impuestos: ",React.createElement("strong",null,"$",(formData.tax_info.other_taxes||0).toLocaleString("es-MX",{minimumFractionDigits:2})))),Array.isArray(formData.tax_info.taxes)&&formData.tax_info.taxes.length>0&&React.createElement("div",{className:"mt-2 text-xs text-green-700 space-y-1"},formData.tax_info.taxes.map(function(tax,idx){return React.createElement("div",{key:idx,className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-check text-green-500"}),React.createElement("span",null,tax.kind==="retencion"?"Retenci\xF3n":"Impuesto"," ",tax.type," \u2022 ",tax.rate?"".concat((tax.rate*100).toFixed(2),"%"):""," \u2022 $",Number(tax.amount||0).toLocaleString("es-MX",{minimumFractionDigits:2})))})))),React.createElement("div",{className:"bg-white border-t border-gray-200 px-6 py-4 rounded-lg shadow-md"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-4"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 rounded-full ".concat(missingRequiredFields.length===0?"bg-green-500":progress>=50?"bg-yellow-500":"bg-red-500")}),React.createElement("span",{className:"text-sm text-gray-600"},missingRequiredFields.length===0?"Listo para enviar":progress>=50?"En progreso":"Necesita m\xE1s informaci\xF3n")),React.createElement("div",{className:"text-sm text-gray-500"},progress,"% completo"),missingRequiredFields.length>0&&React.createElement("div",{className:"text-sm text-red-600"},missingRequiredFields.length," campos requeridos faltantes")),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("button",{onClick:handleSaveDraft,disabled:Object.keys(formData).filter(function(k){return!k.startsWith("_")}).length===0||isSaving||isSending,className:"px-4 py-2 text-sm font-medium rounded-md border transition-colors ".concat(Object.keys(formData).filter(function(k){return!k.startsWith("_")}).length>0&&!isSaving&&!isSending?"text-gray-700 bg-white border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border-gray-200 cursor-not-allowed")},isSaving?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner fa-spin mr-2"}),"Guardando..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-save mr-2"}),"Guardar Borrador")),React.createElement("button",{onClick:handleSendToOdoo,disabled:missingRequiredFields.length>0||isSaving||isSending||isCheckingDuplicates,className:"px-6 py-2 text-sm font-medium rounded-md transition-colors ".concat(missingRequiredFields.length===0&&!isSaving&&!isSending&&!isCheckingDuplicates?"text-white bg-blue-600 hover:bg-blue-700":"text-gray-400 bg-gray-200 cursor-not-allowed")},isCheckingDuplicates?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-search fa-spin mr-2"}),"Verificando duplicados..."):isSending?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner fa-spin mr-2"}),"Enviando a Odoo..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-paper-plane mr-2"}),"Enviar a Odoo"))))),lastSaveTime&&React.createElement("div",{className:"fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded-lg shadow-lg slide-in"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-check"}),React.createElement("span",{className:"text-sm"},"Borrador guardado a las ",lastSaveTime.toLocaleTimeString()))),showExpensesDashboard&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"},React.createElement("div",{className:"p-6 border-b border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"Dashboard de Gastos"),React.createElement("p",{className:"text-gray-600 mt-1"},"An\xE1lisis y resumen de tus gastos empresariales")),React.createElement("button",{onClick:function onClick(){return setShowExpensesDashboard(false)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar modal de dashboard"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement(DashboardContent,{expensesData:expensesData,selectedMonth:selectedMonth,setSelectedMonth:setSelectedMonth,selectedCategoryFilter:selectedCategoryFilter,setSelectedCategoryFilter:setSelectedCategoryFilter,categorias:CATEGORIAS_DISPONIBLES,getCategoryInfo:getCategoryInfo}))),showPendingInvoices&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full"},React.createElement("div",{className:"p-6 border-b border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"Facturas Pendientes"),React.createElement("button",{onClick:function onClick(){return setShowPendingInvoices(false)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar facturas pendientes"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement(PendingInvoicesContent,{expensesData:expensesData,onRegisterInvoice:registerInvoiceForExpense,onMarkInvoiced:markExpenseAsInvoiced,onCloseNoInvoice:closeExpenseWithoutInvoice,onOpenNonReconciliation:function onOpenNonReconciliation(expense){setSelectedExpenseForNonReconciliation(expense);setShowNonReconciliationModal(true)}}))),showInvoiceUpload&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},React.createElement("div",{className:"p-6 border-b border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"Carga Masiva de Facturas"),React.createElement("p",{className:"text-gray-600 mt-1"},"Sube m\xFAltiples facturas para procesamiento autom\xE1tico")),React.createElement("button",{onClick:function onClick(){return setShowInvoiceUpload(false)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar carga de facturas"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement(InvoiceUploadContent,{expensesData:expensesData,setExpensesData:setExpensesData}))),showReconciliation&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"},React.createElement("div",{className:"p-6 border-b border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"Conciliador de Gastos"),React.createElement("p",{className:"text-gray-600 mt-1"},"Concilia gastos registrados con facturas recibidas")),React.createElement("button",{onClick:function onClick(){return setShowReconciliation(false)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar conciliaci\xF3n"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement(ReconciliationContent,{expensesData:expensesData}))),showBankReconciliation&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[95vh] overflow-y-auto"},React.createElement("div",{className:"p-6 border-b border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"Conciliaci\xF3n bancaria"),React.createElement("p",{className:"text-gray-600 mt-1"},"Asocia los gastos conciliados con sus movimientos bancarios.")),React.createElement("button",{onClick:function onClick(){return setShowBankReconciliation(false)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar conciliaci\xF3n bancaria"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement(BankReconciliationContent,{expensesData:expensesData,onUpdateExpense:updateExpense}))),showCompletenessView&&React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[95vh] overflow-y-auto"},React.createElement("div",{className:"p-6 border-b border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h2",{className:"text-xl font-bold text-gray-900"},"Vista Contable y Completitud"),React.createElement("p",{className:"text-gray-600 mt-1"},"Revisa el estado contable, asientos y completitud de cada transacci\xF3n")),React.createElement("button",{onClick:function onClick(){return setShowCompletenessView(false)},className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar vista contable"},React.createElement("i",{className:"fas fa-times text-xl"})))),React.createElement(CompletenessView,{expensesData:expensesData,getCategoryInfo:getCategoryInfo}))),showConversationalAssistant&&React.createElement(ConversationalAssistantModal,{onClose:function onClose(){return setShowConversationalAssistant(false)}}),React.createElement(NonReconciliationModal,{isOpen:showNonReconciliationModal,onClose:function onClose(){return setShowNonReconciliationModal(false)},expense:selectedExpenseForNonReconciliation,onSubmit:function onSubmit(result){console.log("Non-reconciliation marked:",result)}}))};var root=ReactDOM.createRoot(document.getElementById("app-root"));root.render(React.createElement(ExpenseRegistration,null));
