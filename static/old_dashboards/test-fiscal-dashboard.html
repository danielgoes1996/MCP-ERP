<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test Dashboard Fiscal Simple</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .metric { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>üìä Test Dashboard Fiscal - Octubre 2025</h1>

    <div id="status">Cargando datos...</div>

    <div id="metrics" style="display:none;">
        <h2>Resumen del Mes</h2>
        <div class="metric">
            <strong>Total Gastos:</strong> <span id="totalGastos">-</span>
        </div>
        <div class="metric">
            <strong>IVA Acreditable:</strong> <span id="ivaAcreditable">-</span>
        </div>
        <div class="metric">
            <strong>Gastos con CFDI:</strong> <span id="conCfdi">-</span>
        </div>
        <div class="metric">
            <strong>Categor√≠as:</strong>
            <ul id="categorias"></ul>
        </div>
    </div>

    <script>
        async function cargarDatos() {
            const statusDiv = document.getElementById('status');
            const metricsDiv = document.getElementById('metrics');

            try {
                // Llamada directa a la API
                const response = await fetch('/api/v1/reports/resumen-fiscal?year=2025&month=10');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                console.log('Datos recibidos:', data);

                // Mostrar m√©tricas
                document.getElementById('totalGastos').textContent =
                    `$${data.totales.gastos_total.toFixed(2)} MXN`;
                document.getElementById('ivaAcreditable').textContent =
                    `$${data.totales.iva_acreditable.toFixed(2)} MXN`;
                document.getElementById('conCfdi').textContent =
                    `${data.cfdi.con_cfdi} de ${data.cfdi.con_cfdi + data.cfdi.sin_cfdi} (${data.cfdi.porcentaje_cfdi.toFixed(1)}%)`;

                // Mostrar categor√≠as
                const categoriasUl = document.getElementById('categorias');
                categoriasUl.innerHTML = '';
                data.categorias.forEach(cat => {
                    const li = document.createElement('li');
                    li.textContent = `${cat.slug}: $${cat.total.toFixed(2)} (${cat.cantidad} gastos)`;
                    categoriasUl.appendChild(li);
                });

                statusDiv.className = 'success';
                statusDiv.textContent = '‚úÖ Datos cargados exitosamente';
                metricsDiv.style.display = 'block';

            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.textContent = `‚ùå Error: ${error.message}`;
                console.error('Error:', error);
            }
        }

        // Cargar al iniciar
        cargarDatos();
    </script>
</body>
</html>