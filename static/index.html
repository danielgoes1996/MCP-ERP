<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Server - Carreta Verde</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .recording {
            animation: pulse 1.5s infinite;
        }

        .json-viewer {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #f0f0f0;
            border-radius: 8px;
            padding: 16px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .step {
            transition: all 0.3s ease;
        }

        .step.active {
            background-color: #3b82f6;
            color: white;
        }

        .step.completed {
            background-color: #10b981;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-green-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <i class="fas fa-truck text-3xl"></i>
                <div>
                    <h1 class="text-2xl font-bold">Carreta Verde</h1>
                    <p class="text-green-200">MCP Server - GestiÃ³n de Gastos por Voz</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <span class="flex items-center">
                    <div class="w-3 h-3 bg-green-300 rounded-full mr-2"></div>
                    Odoo Conectado
                </span>
            </div>
        </div>
    </header>

    <div class="container mx-auto p-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Panel de Control de Voz -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-microphone mr-2 text-blue-500"></i>
                    Control de Voz
                </h2>

                <!-- BotÃ³n de GrabaciÃ³n -->
                <div class="text-center mb-6">
                    <button id="recordButton"
                            class="w-32 h-32 bg-red-500 hover:bg-red-600 text-white rounded-full text-4xl transition-all duration-300 shadow-lg">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <p id="recordStatus" class="mt-2 text-gray-600">Presiona para grabar</p>
                </div>

                <!-- Upload de Archivo -->
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 mb-4">
                    <input type="file" id="audioFile" accept="audio/*" class="hidden">
                    <label for="audioFile" class="cursor-pointer block text-center">
                        <i class="fas fa-upload text-3xl text-gray-400 mb-2"></i>
                        <p class="text-gray-600">O sube un archivo de audio</p>
                    </label>
                </div>

                <!-- Controles -->
                <div class="flex space-x-2 mb-4">
                    <button id="sendButton"
                            class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg disabled:opacity-50"
                            disabled>
                        <i class="fas fa-paper-plane mr-2"></i>
                        Enviar a MCP
                    </button>
                    <button id="clearButton"
                            class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-trash mr-2"></i>
                        Limpiar
                    </button>
                </div>

                <!-- Audio Player -->
                <div id="audioPlayerContainer" class="hidden">
                    <audio id="audioPlayer" controls class="w-full mb-2"></audio>
                    <p class="text-sm text-gray-600">Audio grabado listo para enviar</p>
                </div>
            </div>

            <!-- Panel de Flujo MCP -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-cogs mr-2 text-green-500"></i>
                    Flujo MCP en Tiempo Real
                </h2>

                <!-- Pasos del Proceso -->
                <div class="space-y-3 mb-6">
                    <div id="step1" class="step flex items-center p-3 bg-gray-100 rounded-lg">
                        <i class="fas fa-microphone mr-3"></i>
                        <span>1. Recibir Audio</span>
                        <i class="fas fa-spinner fa-spin ml-auto hidden" id="loading1"></i>
                    </div>
                    <div id="step2" class="step flex items-center p-3 bg-gray-100 rounded-lg">
                        <i class="fas fa-brain mr-3"></i>
                        <span>2. TranscripciÃ³n (Whisper)</span>
                        <i class="fas fa-spinner fa-spin ml-auto hidden" id="loading2"></i>
                    </div>
                    <div id="step3" class="step flex items-center p-3 bg-gray-100 rounded-lg">
                        <i class="fas fa-search mr-3"></i>
                        <span>3. Procesamiento NLP</span>
                        <i class="fas fa-spinner fa-spin ml-auto hidden" id="loading3"></i>
                    </div>
                    <div id="step4" class="step flex items-center p-3 bg-gray-100 rounded-lg">
                        <i class="fas fa-database mr-3"></i>
                        <span>4. Crear en Odoo</span>
                        <i class="fas fa-spinner fa-spin ml-auto hidden" id="loading4"></i>
                    </div>
                    <div id="step5" class="step flex items-center p-3 bg-gray-100 rounded-lg">
                        <i class="fas fa-volume-up mr-3"></i>
                        <span>5. Generar Respuesta</span>
                        <i class="fas fa-spinner fa-spin ml-auto hidden" id="loading5"></i>
                    </div>
                </div>

                <!-- InformaciÃ³n del Ãšltimo Gasto -->
                <div id="lastExpense" class="hidden bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 class="font-bold text-green-800 mb-2">âœ… Ãšltimo Gasto Creado</h3>
                    <div class="text-sm space-y-1">
                        <p><strong>ID Odoo:</strong> <span id="expenseId">-</span></p>
                        <p><strong>Monto:</strong> $<span id="expenseAmount">-</span></p>
                        <p><strong>DescripciÃ³n:</strong> <span id="expenseDesc">-</span></p>
                        <p><strong>Estado:</strong> <span id="expenseStatus">-</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel de JSON en Tiempo Real -->
        <div class="mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-code mr-2 text-purple-500"></i>
                Respuesta JSON en Tiempo Real
                <button id="copyJson" class="ml-auto bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm">
                    <i class="fas fa-copy mr-1"></i>
                    Copiar
                </button>
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <!-- Request -->
                <div>
                    <h3 class="font-semibold mb-2 text-gray-700">ðŸ”¼ Request Enviado</h3>
                    <div id="jsonRequest" class="json-viewer h-48">
{
  "esperando": "archivo de audio..."
}
                    </div>
                </div>

                <!-- Response -->
                <div>
                    <h3 class="font-semibold mb-2 text-gray-700">ðŸ”½ Response Recibido</h3>
                    <div id="jsonResponse" class="json-viewer h-48">
{
  "esperando": "respuesta del servidor..."
}
                    </div>
                </div>
            </div>
        </div>

        <!-- Historial de Gastos -->
        <div class="mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-history mr-2 text-orange-500"></i>
                Historial de Gastos por Voz
                <button id="refreshHistory" class="ml-auto bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-sm">
                    <i class="fas fa-sync mr-1"></i>
                    Actualizar
                </button>
            </h2>

            <div id="expenseHistory" class="space-y-2">
                <!-- Se llenarÃ¡ dinÃ¡micamente -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/app.js"></script>
</body>
</html>